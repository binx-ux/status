-- GLOBAL UNLOAD FLAG - This will kill everything when external scripts load
_G.BinxixUnloaded = false

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local player = Players.LocalPlayer


local currentPlaceId = game.PlaceId

-- MM2: Load Vertex immediately
if currentPlaceId == 142823291 then
    _G.BinxixUnloaded = true
    
    -- Show loading notification
    local notifGui = Instance.new("ScreenGui")
    notifGui.Name = "ScriptLoader"
    notifGui.ResetOnSpawn = false
    notifGui.IgnoreGuiInset = true
    notifGui.Parent = player:WaitForChild("PlayerGui")
    
    local notifFrame = Instance.new("Frame")
    notifFrame.Size = UDim2.new(0, 320, 0, 80)
    notifFrame.Position = UDim2.new(0.5, -160, 0.5, -40)
    notifFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    notifFrame.BorderSizePixel = 0
    notifFrame.Parent = notifGui
    Instance.new("UICorner", notifFrame).CornerRadius = UDim.new(0, 10)
    local notifStroke = Instance.new("UIStroke", notifFrame)
    notifStroke.Color = Color3.fromRGB(130, 80, 200)
    notifStroke.Thickness = 2
    
    local notifText = Instance.new("TextLabel")
    notifText.Size = UDim2.new(1, -20, 1, -20)
    notifText.Position = UDim2.new(0, 10, 0, 10)
    notifText.BackgroundTransparency = 1
    notifText.Text = " Loading Vertex for MM2...\nBinxix GUI skipped"
    notifText.TextColor3 = Color3.fromRGB(255, 255, 255)
    notifText.TextSize = 12
    notifText.Font = Enum.Font.GothamBold
    notifText.TextWrapped = true
    notifText.Parent = notifFrame
    
    -- Load Vertex
    task.spawn(function()
        task.wait(0.5)
        local success, err = pcall(function()
            local scriptContent = game:HttpGet("https://raw.smokingscripts.org/vertex.lua")
            loadstring(scriptContent)()
        end)
        
        if success then
            notifText.Text = " Vertex Loaded for MM2!"
            notifFrame.BackgroundColor3 = Color3.fromRGB(20, 40, 20)
            notifStroke.Color = Color3.fromRGB(80, 255, 120)
            task.wait(2)
            notifGui:Destroy()
        else
            notifText.Text = " Failed to load Vertex\n" .. tostring(err)
            notifFrame.BackgroundColor3 = Color3.fromRGB(40, 20, 20)
            notifStroke.Color = Color3.fromRGB(255, 80, 80)
            task.wait(3)
            notifGui:Destroy()
        end
    end)
    
    return 
end

-- TSB: Load Phantasm immediately
if currentPlaceId == 10449761463 then
    _G.BinxixUnloaded = true
    
    -- Show loading notification
    local notifGui = Instance.new("ScreenGui")
    notifGui.Name = "ScriptLoader"
    notifGui.ResetOnSpawn = false
    notifGui.IgnoreGuiInset = true
    notifGui.Parent = player:WaitForChild("PlayerGui")
    
    local notifFrame = Instance.new("Frame")
    notifFrame.Size = UDim2.new(0, 320, 0, 80)
    notifFrame.Position = UDim2.new(0.5, -160, 0.5, -40)
    notifFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    notifFrame.BorderSizePixel = 0
    notifFrame.Parent = notifGui
    Instance.new("UICorner", notifFrame).CornerRadius = UDim.new(0, 10)
    local notifStroke = Instance.new("UIStroke", notifFrame)
    notifStroke.Color = Color3.fromRGB(130, 80, 200)
    notifStroke.Thickness = 2
    
    local notifText = Instance.new("TextLabel")
    notifText.Size = UDim2.new(1, -20, 1, -20)
    notifText.Position = UDim2.new(0, 10, 0, 10)
    notifText.BackgroundTransparency = 1
    notifText.Text = " Loading Phantasm for TSB...\nBinxix GUI skipped"
    notifText.TextColor3 = Color3.fromRGB(255, 255, 255)
    notifText.TextSize = 12
    notifText.Font = Enum.Font.GothamBold
    notifText.TextWrapped = true
    notifText.Parent = notifFrame
    
    -- Load Phantasm
    task.spawn(function()
        task.wait(0.5)
        local success, err = pcall(function()
            local scriptContent = game:HttpGet("https://raw.githubusercontent.com/ATrainz/Phantasm/refs/heads/main/Games/TSB.lua")
            loadstring(scriptContent)()
        end)
        
        if success then
            notifText.Text = " Phantasm Loaded for TSB!"
            notifFrame.BackgroundColor3 = Color3.fromRGB(20, 40, 20)
            notifStroke.Color = Color3.fromRGB(80, 255, 120)
            task.wait(2)
            notifGui:Destroy()
        else
            notifText.Text = " Failed to load Phantasm\n" .. tostring(err)
            notifFrame.BackgroundColor3 = Color3.fromRGB(40, 20, 20)
            notifStroke.Color = Color3.fromRGB(255, 80, 80)
            task.wait(3)
            notifGui:Destroy()
        end
    end)
    
    return -- Stop Binxix script here
end

local currentPlaceId = game.PlaceId

-- MM2 Detection
if currentPlaceId == 142823291 then
    _G.BinxixUnloaded = true
    
    local notifGui = Instance.new("ScreenGui")
    notifGui.Name = "BinxixLoader"
    notifGui.ResetOnSpawn = false
    notifGui.IgnoreGuiInset = true
    notifGui.Parent = player:WaitForChild("PlayerGui")
    
    local notifFrame = Instance.new("Frame")
    notifFrame.Size = UDim2.new(0, 320, 0, 80)
    notifFrame.Position = UDim2.new(0.5, -160, 0.5, -40)
    notifFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    notifFrame.BorderSizePixel = 0
    notifFrame.Parent = notifGui
    Instance.new("UICorner", notifFrame).CornerRadius = UDim.new(0, 10)
    local notifStroke = Instance.new("UIStroke", notifFrame)
    notifStroke.Color = Color3.fromRGB(130, 80, 200)
    notifStroke.Thickness = 2
    
    local notifText = Instance.new("TextLabel")
    notifText.Size = UDim2.new(1, -20, 1, -20)
    notifText.Position = UDim2.new(0, 10, 0, 10)
    notifText.BackgroundTransparency = 1
    notifText.Text = " MM2 Detected!\nLoading Vertex..."
    notifText.TextColor3 = Color3.fromRGB(255, 255, 255)
    notifText.TextSize = 12
    notifText.Font = Enum.Font.GothamBold
    notifText.TextWrapped = true
    notifText.Parent = notifFrame
    
    task.spawn(function()
        task.wait(0.5)
        local success, err = pcall(function()
            local scriptContent = game:HttpGet("https://raw.smokingscripts.org/vertex.lua")
            loadstring(scriptContent)()
        end)
        
        if success then
            notifText.Text = " Vertex Loaded!"
            notifFrame.BackgroundColor3 = Color3.fromRGB(20, 40, 20)
            notifStroke.Color = Color3.fromRGB(80, 255, 120)
            task.wait(2)
            notifGui:Destroy()
        else
            notifText.Text = " Failed to load Vertex\n" .. tostring(err)
            notifFrame.BackgroundColor3 = Color3.fromRGB(40, 20, 20)
            notifStroke.Color = Color3.fromRGB(255, 80, 80)
            task.wait(3)
            notifGui:Destroy()
        end
    end)
    
    return -- Stop script execution
end

-- TSB Detection
if currentPlaceId == 10449761463 then
    _G.BinxixUnloaded = true
    
    local notifGui = Instance.new("ScreenGui")
    notifGui.Name = "BinxixLoader"
    notifGui.ResetOnSpawn = false
    notifGui.IgnoreGuiInset = true
    notifGui.Parent = player:WaitForChild("PlayerGui")
    
    local notifFrame = Instance.new("Frame")
    notifFrame.Size = UDim2.new(0, 320, 0, 80)
    notifFrame.Position = UDim2.new(0.5, -160, 0.5, -40)
    notifFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    notifFrame.BorderSizePixel = 0
    notifFrame.Parent = notifGui
    Instance.new("UICorner", notifFrame).CornerRadius = UDim.new(0, 10)
    local notifStroke = Instance.new("UIStroke", notifFrame)
    notifStroke.Color = Color3.fromRGB(130, 80, 200)
    notifStroke.Thickness = 2
    
    local notifText = Instance.new("TextLabel")
    notifText.Size = UDim2.new(1, -20, 1, -20)
    notifText.Position = UDim2.new(0, 10, 0, 10)
    notifText.BackgroundTransparency = 1
    notifText.Text = " TSB Detected!\nLoading Phantasm..."
    notifText.TextColor3 = Color3.fromRGB(255, 255, 255)
    notifText.TextSize = 12
    notifText.Font = Enum.Font.GothamBold
    notifText.TextWrapped = true
    notifText.Parent = notifFrame
    
    task.spawn(function()
        task.wait(0.5)
        local success, err = pcall(function()
            local scriptContent = game:HttpGet("https://raw.githubusercontent.com/ATrainz/Phantasm/refs/heads/main/Games/TSB.lua")
            loadstring(scriptContent)()
        end)
        
        if success then
            notifText.Text = " Phantasm Loaded!"
            notifFrame.BackgroundColor3 = Color3.fromRGB(20, 40, 20)
            notifStroke.Color = Color3.fromRGB(80, 255, 120)
            task.wait(2)
            notifGui:Destroy()
        else
            notifText.Text = " Failed to load Phantasm\n" .. tostring(err)
            notifFrame.BackgroundColor3 = Color3.fromRGB(40, 20, 20)
            notifStroke.Color = Color3.fromRGB(255, 80, 80)
            task.wait(3)
            notifGui:Destroy()
        end
    end)
    
    return -- Stop script execution
end

local function createLoadingScreen()
    local loadingGui = Instance.new("ScreenGui")
    loadingGui.Name = "BinxixLoadingScreen"
    loadingGui.ResetOnSpawn = false
    loadingGui.IgnoreGuiInset = true
    loadingGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    loadingGui.Parent = player:WaitForChild("PlayerGui")
    
    -- Semi-transparent background overlay
    local overlay = Instance.new("Frame")
    overlay.Size = UDim2.new(1, 0, 1, 0)
    overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    overlay.BackgroundTransparency = 0.5
    overlay.BorderSizePixel = 0
    overlay.Parent = loadingGui
    
    -- Main loading box
    local loadingBox = Instance.new("Frame")
    loadingBox.Size = UDim2.new(0, 450, 0, 300)
    loadingBox.Position = UDim2.new(0.5, -225, 0.5, -150)
    loadingBox.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
    loadingBox.BorderSizePixel = 0
    loadingBox.Parent = loadingGui
    local boxCorner = Instance.new("UICorner")
    boxCorner.CornerRadius = UDim.new(0, 15)
    boxCorner.Parent = loadingBox
    local boxStroke = Instance.new("UIStroke")
    boxStroke.Color = Color3.fromRGB(130, 80, 200)
    boxStroke.Thickness = 2
    boxStroke.Parent = loadingBox
    
    -- Gradient overlay on box
    local gradient = Instance.new("Frame")
    gradient.Size = UDim2.new(1, 0, 1, 0)
    gradient.BackgroundTransparency = 0.7
    gradient.BorderSizePixel = 0
    gradient.Parent = loadingBox
    local gradientCorner = Instance.new("UICorner")
    gradientCorner.CornerRadius = UDim.new(0, 15)
    gradientCorner.Parent = gradient
    local gradientUI = Instance.new("UIGradient")
    gradientUI.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 30, 60)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(15, 15, 20)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 20, 45))
    }
    gradientUI.Rotation = 45
    gradientUI.Parent = gradient
    
    -- Logo container
    local logoFrame = Instance.new("Frame")
    logoFrame.Size = UDim2.new(0, 80, 0, 80)
    logoFrame.Position = UDim2.new(0.5, -40, 0, 30)
    logoFrame.BackgroundColor3 = Color3.fromRGB(130, 80, 200)
    logoFrame.BorderSizePixel = 0
    logoFrame.Parent = loadingBox
    local logoCorner = Instance.new("UICorner")
    logoCorner.CornerRadius = UDim.new(0, 15)
    logoCorner.Parent = logoFrame
    local logoStroke = Instance.new("UIStroke")
    logoStroke.Color = Color3.fromRGB(160, 100, 255)
    logoStroke.Thickness = 2
    logoStroke.Parent = logoFrame
    
    -- Logo icon
    local logoIcon = Instance.new("TextLabel")
    logoIcon.Size = UDim2.new(1, 0, 1, 0)
    logoIcon.BackgroundTransparency = 1
    logoIcon.Text = "B"
    logoIcon.TextColor3 = Color3.fromRGB(255, 255, 255)
    logoIcon.TextSize = 50
    logoIcon.Font = Enum.Font.GothamBold
    logoIcon.Parent = logoFrame
    
    -- Title
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -40, 0, 35)
    title.Position = UDim2.new(0, 20, 0, 120)
    title.BackgroundTransparency = 1
    title.Text = "BINXIX'S GUI V6"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 24
    title.Font = Enum.Font.GothamBold
    title.Parent = loadingBox
    
    -- Version
    local version = Instance.new("TextLabel")
    version.Size = UDim2.new(1, -40, 0, 20)
    version.Position = UDim2.new(0, 20, 0, 155)
    version.BackgroundTransparency = 1
    version.Text = "Premium Edition"
    version.TextColor3 = Color3.fromRGB(160, 100, 255)
    version.TextSize = 12
    version.Font = Enum.Font.Gotham
    version.Parent = loadingBox
    
    -- Percentage text
    local percentText = Instance.new("TextLabel")
    percentText.Size = UDim2.new(1, -40, 0, 25)
    percentText.Position = UDim2.new(0, 20, 0, 185)
    percentText.BackgroundTransparency = 1
    percentText.Text = "0%"
    percentText.TextColor3 = Color3.fromRGB(160, 100, 255)
    percentText.TextSize = 14
    percentText.Font = Enum.Font.GothamBold
    percentText.Parent = loadingBox
    
    -- Progress bar background
    local progressBg = Instance.new("Frame")
    progressBg.Size = UDim2.new(1, -40, 0, 6)
    progressBg.Position = UDim2.new(0, 20, 0, 215)
    progressBg.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    progressBg.BorderSizePixel = 0
    progressBg.Parent = loadingBox
    local progressBgCorner = Instance.new("UICorner")
    progressBgCorner.CornerRadius = UDim.new(1, 0)
    progressBgCorner.Parent = progressBg
    
    -- Progress bar fill
    local progressFill = Instance.new("Frame")
    progressFill.Size = UDim2.new(0, 0, 1, 0)
    progressFill.BackgroundColor3 = Color3.fromRGB(130, 80, 200)
    progressFill.BorderSizePixel = 0
    progressFill.Parent = progressBg
    local progressFillCorner = Instance.new("UICorner")
    progressFillCorner.CornerRadius = UDim.new(1, 0)
    progressFillCorner.Parent = progressFill
    
    -- Progress bar glow
    local progressGlow = Instance.new("UIStroke")
    progressGlow.Color = Color3.fromRGB(160, 100, 255)
    progressGlow.Thickness = 1
    progressGlow.Transparency = 0.5
    progressGlow.Parent = progressFill
    
    -- Loading text
    local loadingText = Instance.new("TextLabel")
    loadingText.Size = UDim2.new(1, -40, 0, 30)
    loadingText.Position = UDim2.new(0, 20, 0, 230)
    loadingText.BackgroundTransparency = 1
    loadingText.Text = "Initializing..."
    loadingText.TextColor3 = Color3.fromRGB(200, 200, 200)
    loadingText.TextSize = 11
    loadingText.Font = Enum.Font.Gotham
    loadingText.Parent = loadingBox
    
    -- Play loading music
    local sound = Instance.new("Sound")
    sound.SoundId = "rbxassetid://2765973636"
    sound.Volume = 0.5
    sound.Looped = true
    sound.Parent = loadingBox
    sound:Play()
    
    -- Loading stages
    local stages = {
        {progress = 0.15, text = " Scanning game environment..."},
        {progress = 0.30, text = " Getting files..."},
        {progress = 0.45, text = " Loading code modules..."},
        {progress = 0.60, text = " Building interface..."},
        {progress = 0.75, text = " Initializing features..."},
        {progress = 0.90, text = " Finalizing setup..."},
        {progress = 1.00, text = " Ready!"},
    }
    
    -- Animate loading
    task.spawn(function()
        for i, stage in ipairs(stages) do
            loadingText.Text = stage.text
            percentText.Text = math.floor(stage.progress * 100) .. "%"
            
            -- Animate progress bar
            TweenService:Create(
                progressFill,
                TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                {Size = UDim2.new(stage.progress, 0, 1, 0)}
            ):Play()
            
            task.wait(0.6)
        end
        
        -- Fade out completely
        task.wait(0.5)
        sound:Stop()
        sound:Destroy()
        
        -- Fade overlay
        TweenService:Create(
            overlay,
            TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {BackgroundTransparency = 1}
        ):Play()
        
        -- Fade and shrink loading box
        TweenService:Create(
            loadingBox,
            TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {BackgroundTransparency = 1, Size = UDim2.new(0, 400, 0, 250)}
        ):Play()
        
        TweenService:Create(
            boxStroke,
            TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Transparency = 1}
        ):Play()
        
        -- Fade all children
        for _, child in ipairs(loadingBox:GetDescendants()) do
            if child:IsA("TextLabel") then
                TweenService:Create(
                    child,
                    TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {TextTransparency = 1}
                ):Play()
            elseif child:IsA("Frame") and child ~= gradient then
                TweenService:Create(
                    child,
                    TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {BackgroundTransparency = 1}
                ):Play()
            elseif child:IsA("UIStroke") then
                TweenService:Create(
                    child,
                    TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
                    {Transparency = 1}
                ):Play()
            end
        end
        
        task.wait(0.5)
        loadingGui:Destroy()
    end)
    
    return loadingGui
end

-- Create and show loading screen
-- Check if external script was chosen from hub (flag set before loading screen)
if not _G.BinxixUnloaded then
    createLoadingScreen()
    task.wait(4.5) -- Wait for loading to complete
end

-- Check again after loading screen
if _G.BinxixUnloaded then
    -- Stop execution here, external script is handling everything
    return
end



local supportedGames = {
    [286090429] = {name = "Arsenal", icon = "", color = Color3.fromRGB(255, 100, 50), espEnabled = true},
    [9157605735] = {name = "MiscGunTest-X", icon = "", color = Color3.fromRGB(100, 200, 255), espEnabled = false},
    [155615604] = {name = "PR", icon = "", color = Color3.fromRGB(255, 150, 50), espEnabled = true},
    [95721658376580] = {name = "MTC", icon = "", color = Color3.fromRGB(255, 220, 50), espEnabled = true},
    [83728249169833] = {name = "Quick-Shot", icon = "", color = Color3.fromRGB(150, 100, 255), espEnabled = true},
    [109397169461300] = {name = "SNIPER DUELS", icon = "", color = Color3.fromRGB(80, 200, 120), espEnabled = false},
    [142823291] = {name = "Murder Mystery 2", icon = "", color = Color3.fromRGB(255, 50, 50), espEnabled = false, loadScript = "https://raw.smokingscripts.org/vertex.lua", scriptName = "Vertex"},
    [10449761463] = {name = "The Strongest Battlegrounds", icon = "", color = Color3.fromRGB(255, 200, 50), espEnabled = false, loadScript = "https://raw.githubusercontent.com/ATrainz/Phantasm/refs/heads/main/Games/TSB.lua", scriptName = "Phantasm"},
}

local currentPlaceId = game.PlaceId
local currentGameData = supportedGames[currentPlaceId]

-- Notification function
local function showNotification(title, message, duration, isError)
    local screenGui = player:WaitForChild("PlayerGui"):FindFirstChild("BinxixNotifications")
    if not screenGui then
        screenGui = Instance.new("ScreenGui")
        screenGui.Name = "BinxixNotifications"
        screenGui.ResetOnSpawn = false
        screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        screenGui.IgnoreGuiInset = true
        screenGui.Parent = player:WaitForChild("PlayerGui")
    end
    
    local notif = Instance.new("Frame")
    notif.Size = UDim2.new(0, 300, 0, 0)
    notif.Position = UDim2.new(1, -320, 0, 20)
    notif.BackgroundColor3 = isError and Color3.fromRGB(40, 20, 20) or Color3.fromRGB(20, 20, 25)
    notif.BorderSizePixel = 0
    notif.Parent = screenGui
    
    local notifCorner = Instance.new("UICorner")
    notifCorner.CornerRadius = UDim.new(0, 8)
    notifCorner.Parent = notif
    
    local notifStroke = Instance.new("UIStroke")
    notifStroke.Color = isError and Color3.fromRGB(255, 80, 80) or Color3.fromRGB(130, 80, 200)
    notifStroke.Thickness = 2
    notifStroke.Parent = notif
    
    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, -20, 0, 24)
    titleLabel.Position = UDim2.new(0, 10, 0, 8)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextSize = 14
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = notif
    
    local messageLabel = Instance.new("TextLabel")
    messageLabel.Size = UDim2.new(1, -20, 0, 0)
    messageLabel.Position = UDim2.new(0, 10, 0, 32)
    messageLabel.BackgroundTransparency = 1
    messageLabel.Text = message
    messageLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    messageLabel.TextSize = 11
    messageLabel.Font = Enum.Font.Gotham
    messageLabel.TextXAlignment = Enum.TextXAlignment.Left
    messageLabel.TextYAlignment = Enum.TextYAlignment.Top
    messageLabel.TextWrapped = true
    messageLabel.Parent = notif
    
    -- Calculate text height
    local textHeight = game:GetService("TextService"):GetTextSize(
        message,
        11,
        Enum.Font.Gotham,
        Vector2.new(280, math.huge)
    ).Y
    
    messageLabel.Size = UDim2.new(1, -20, 0, textHeight)
    local totalHeight = 40 + textHeight + 10
    
    -- Animate in
    notif:TweenSize(
        UDim2.new(0, 300, 0, totalHeight),
        Enum.EasingDirection.Out,
        Enum.EasingStyle.Quad,
        0.3,
        true
    )
    
    -- Auto-dismiss
    task.spawn(function()
        task.wait(duration or 4)
        notif:TweenSize(
            UDim2.new(0, 300, 0, 0),
            Enum.EasingDirection.In,
            Enum.EasingStyle.Quad,
            0.3,
            true
        )
        task.wait(0.3)
        notif:Destroy()
    end)
end

-- Check if game is tested/supported
if not currentGameData then
    -- Game not in supported list - show warning but continue
    currentGameData = {
        name = "Universal", 
        icon = "", 
        color = Color3.fromRGB(255, 180, 50), 
        espEnabled = true
    }
    showNotification(
        " Game Not Tested",
        "Place ID: " .. tostring(currentPlaceId) .. "\n\nThis game hasn't been tested with Binxix's GUI V5. Some features may not work properly.",
        6,
        true
    )
    warn(" Untested game: " .. currentPlaceId .. " - Running in universal mode")
else
    -- Game is supported
    showNotification(
        " Supported Game",
        "Running on " .. currentGameData.name .. "\nAll features available!",
        3,
        false
    )
end

local gameConfig = {espEnabled = currentGameData.espEnabled}

-- HUB GUI
local hubGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
hubGui.Name = "BinxixHub"
hubGui.IgnoreGuiInset = true
hubGui.ResetOnSpawn = false

-- Background overlay with blur effect
local overlay = Instance.new("Frame", hubGui)
overlay.Size = UDim2.new(1, 0, 1, 0)
overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
overlay.BackgroundTransparency = 0.3
overlay.BorderSizePixel = 0

-- Animated starfield background
local starsContainer = Instance.new("Frame", overlay)
starsContainer.Size = UDim2.new(1, 0, 1, 0)
starsContainer.BackgroundTransparency = 1
starsContainer.BorderSizePixel = 0

-- Create moving stars
local stars = {}
for i = 1, 50 do
    local star = Instance.new("Frame", starsContainer)
    star.Size = UDim2.new(0, math.random(2, 4), 0, math.random(2, 4))
    star.Position = UDim2.new(math.random(), 0, math.random(), 0)
    star.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    star.BackgroundTransparency = math.random(0, 70) / 100
    star.BorderSizePixel = 0
    Instance.new("UICorner", star).CornerRadius = UDim.new(1, 0)
    
    table.insert(stars, {
        frame = star,
        speedX = (math.random() - 0.5) * 0.002,
        speedY = (math.random() - 0.5) * 0.002,
        twinkleSpeed = math.random(2, 5)
    })
end

-- Animate stars
task.spawn(function()
    while hubGui.Parent do
        for _, starData in ipairs(stars) do
            local currentPos = starData.frame.Position
            local newX = currentPos.X.Scale + starData.speedX
            local newY = currentPos.Y.Scale + starData.speedY
            
            -- Wrap around screen
            if newX > 1 then newX = 0 elseif newX < 0 then newX = 1 end
            if newY > 1 then newY = 0 elseif newY < 0 then newY = 1 end
            
            starData.frame.Position = UDim2.new(newX, 0, newY, 0)
            
            -- Twinkling effect
            TweenService:Create(
                starData.frame,
                TweenInfo.new(starData.twinkleSpeed, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true),
                {BackgroundTransparency = math.random(30, 90) / 100}
            ):Play()
        end
        task.wait(0.05)
    end
end)

local hubFrame = Instance.new("Frame", hubGui)
hubFrame.Size = UDim2.new(0, 650, 0, 450)
hubFrame.Position = UDim2.new(0.5, -325, 0.5, -225)
hubFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
hubFrame.BorderSizePixel = 0
local hubCorner = Instance.new("UICorner", hubFrame)
hubCorner.CornerRadius = UDim.new(0, 15)

-- Outer glow
local hubStroke = Instance.new("UIStroke", hubFrame)
hubStroke.Color = Color3.fromRGB(130, 80, 200)
hubStroke.Thickness = 3
hubStroke.Transparency = 0.3

-- Gradient overlay
local gradientOverlay = Instance.new("Frame", hubFrame)
gradientOverlay.Size = UDim2.new(1, 0, 1, 0)
gradientOverlay.BackgroundTransparency = 0.5
gradientOverlay.BorderSizePixel = 0
local gradientCorner = Instance.new("UICorner", gradientOverlay)
gradientCorner.CornerRadius = UDim.new(0, 15)
local gradient = Instance.new("UIGradient", gradientOverlay)
gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 30, 60)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(15, 15, 20)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 20, 40))
}
gradient.Rotation = 135

-- Close button
local closeBtn = Instance.new("TextButton", hubFrame)
closeBtn.Size = UDim2.new(0, 40, 0, 40)
closeBtn.Position = UDim2.new(1, -50, 0, 10)
closeBtn.BackgroundColor3 = Color3.fromRGB(40, 20, 20)
closeBtn.Text = "ðŸ‘Œ"
closeBtn.TextColor3 = Color3.fromRGB(255, 100, 100)
closeBtn.TextSize = 24
closeBtn.Font = Enum.Font.GothamBold
closeBtn.BorderSizePixel = 0
closeBtn.ZIndex = 10
local closeBtnCorner = Instance.new("UICorner", closeBtn)
closeBtnCorner.CornerRadius = UDim.new(0, 8)
local closeBtnStroke = Instance.new("UIStroke", closeBtn)
closeBtnStroke.Color = Color3.fromRGB(255, 80, 80)
closeBtnStroke.Thickness = 2
closeBtnStroke.Transparency = 0.5

-- Close button hover effects
closeBtn.MouseEnter:Connect(function()
    TweenService:Create(closeBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 20, 20)}):Play()
    TweenService:Create(closeBtnStroke, TweenInfo.new(0.2), {Transparency = 0}):Play()
    TweenService:Create(closeBtn, TweenInfo.new(0.2), {TextSize = 26}):Play()
end)

closeBtn.MouseLeave:Connect(function()
    TweenService:Create(closeBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(40, 20, 20)}):Play()
    TweenService:Create(closeBtnStroke, TweenInfo.new(0.2), {Transparency = 0.5}):Play()
    TweenService:Create(closeBtn, TweenInfo.new(0.2), {TextSize = 24}):Play()
end)

closeBtn.MouseButton1Click:Connect(function()
    -- Fade out animation
    TweenService:Create(hubFrame, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
    TweenService:Create(overlay, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
    TweenService:Create(hubStroke, TweenInfo.new(0.3), {Transparency = 1}):Play()
    
    for _, child in ipairs(hubFrame:GetDescendants()) do
        if child:IsA("TextLabel") or child:IsA("TextButton") then
            TweenService:Create(child, TweenInfo.new(0.3), {TextTransparency = 1}):Play()
        end
        if child:IsA("GuiObject") and child ~= hubFrame then
            TweenService:Create(child, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
        end
        if child:IsA("UIStroke") then
            TweenService:Create(child, TweenInfo.new(0.3), {Transparency = 1}):Play()
        end
    end
    
    task.wait(0.35)
    hubGui:Destroy()
end)

-- Header section
local header = Instance.new("Frame", hubFrame)
header.Size = UDim2.new(1, 0, 0, 100)
header.BackgroundColor3 = Color3.fromRGB(20, 15, 30)
header.BorderSizePixel = 0
local headerCorner = Instance.new("UICorner", header)
headerCorner.CornerRadius = UDim.new(0, 15)

-- Header gradient
local headerGradient = Instance.new("UIGradient", header)
headerGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(130, 80, 200)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(80, 40, 120))
}
headerGradient.Rotation = 90

-- Logo icon
local logoIcon = Instance.new("TextLabel", header)
logoIcon.Size = UDim2.new(0, 70, 0, 70)
logoIcon.Position = UDim2.new(0, 20, 0, 15)
logoIcon.BackgroundColor3 = Color3.fromRGB(25, 20, 35)
logoIcon.Text = "B"
logoIcon.TextColor3 = Color3.fromRGB(160, 100, 255)
logoIcon.TextSize = 40
logoIcon.Font = Enum.Font.GothamBold
local logoCorner = Instance.new("UICorner", logoIcon)
logoCorner.CornerRadius = UDim.new(0, 12)
local logoStroke = Instance.new("UIStroke", logoIcon)
logoStroke.Color = Color3.fromRGB(160, 100, 255)
logoStroke.Thickness = 2

-- Title with edgy styling
local title = Instance.new("TextLabel", header)
title.Size = UDim2.new(0, 500, 0, 40)
title.Position = UDim2.new(0, 100, 0, 15)
title.BackgroundTransparency = 1
title.Text = "BINXIX'S // HUB V6 // PHANTOM"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextSize = 26
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Left
title.TextStrokeTransparency = 0.3
title.TextStrokeColor3 = Color3.fromRGB(160, 100, 255)

-- Subtitle
local subtitle = Instance.new("TextLabel", header)
subtitle.Size = UDim2.new(0, 500, 0, 25)
subtitle.Position = UDim2.new(0, 100, 0, 55)
subtitle.BackgroundTransparency = 1
subtitle.Text = "[ SELECT YOUR DOMAIN ]"
subtitle.TextColor3 = Color3.fromRGB(160, 100, 255)
subtitle.TextSize = 13
subtitle.Font = Enum.Font.GothamBold
subtitle.TextXAlignment = Enum.TextXAlignment.Left

-- Global status table that external scripts can modify
_G.BinxixStatus = _G.BinxixStatus or {
    message = "All systems operational",
    color = Color3.fromRGB(80, 255, 120), -- Green for normal
    updateAvailable = false,
    maintenanceMode = false,
    customAnnouncement = nil
}

-- Status panel frame
local statusPanel = Instance.new("Frame", header)
statusPanel.Size = UDim2.new(1, -20, 0, 35)
statusPanel.Position = UDim2.new(0, 10, 1, -45)
statusPanel.BackgroundColor3 = Color3.fromRGB(25, 20, 30)
statusPanel.BorderSizePixel = 0
local statusCorner = Instance.new("UICorner", statusPanel)
statusCorner.CornerRadius = UDim.new(0, 8)
local statusStroke = Instance.new("UIStroke", statusPanel)
statusStroke.Color = _G.BinxixStatus.color
statusStroke.Thickness = 2
statusStroke.Transparency = 0.5

-- Status icon
local statusIcon = Instance.new("TextLabel", statusPanel)
statusIcon.Size = UDim2.new(0, 25, 0, 25)
statusIcon.Position = UDim2.new(0, 8, 0, 5)
statusIcon.BackgroundTransparency = 1
statusIcon.Text = "âœ“"
statusIcon.TextColor3 = _G.BinxixStatus.color
statusIcon.TextSize = 18
statusIcon.Font = Enum.Font.GothamBold

-- Status text
local statusText = Instance.new("TextLabel", statusPanel)
statusText.Size = UDim2.new(1, -45, 1, 0)
statusText.Position = UDim2.new(0, 40, 0, 0)
statusText.BackgroundTransparency = 1
statusText.Text = _G.BinxixStatus.message
statusText.TextColor3 = Color3.fromRGB(255, 255, 255)
statusText.TextSize = 11
statusText.Font = Enum.Font.Gotham
statusText.TextXAlignment = Enum.TextXAlignment.Left
statusText.TextWrapped = true

-- Update function
local function updateStatusPanel()
    local status = _G.BinxixStatus
    
    -- Update message
    statusText.Text = status.message or "All systems operational"
    
    -- Update color
    local targetColor = status.color or Color3.fromRGB(80, 255, 120)
    statusIcon.TextColor3 = targetColor
    statusStroke.Color = targetColor
    
    -- Update icon based on status
    if status.maintenanceMode then
        statusIcon.Text = "âš "
        statusIcon.TextColor3 = Color3.fromRGB(255, 180, 50)
        statusStroke.Color = Color3.fromRGB(255, 180, 50)
        statusText.Text = "âš™ Maintenance: " .. (status.message or "System under maintenance")
    elseif status.updateAvailable then
        statusIcon.Text = "â†»"
        statusIcon.TextColor3 = Color3.fromRGB(100, 200, 255)
        statusStroke.Color = Color3.fromRGB(100, 200, 255)
        statusText.Text = "ðŸ”„ Update: " .. (status.message or "New version ready!")
    elseif status.customAnnouncement then
        statusIcon.Text = "ðŸ“¢"
        statusIcon.TextColor3 = Color3.fromRGB(255, 255, 100)
        statusStroke.Color = Color3.fromRGB(255, 255, 100)
        statusText.Text = "ðŸ“¢ " .. status.customAnnouncement
    else
        statusIcon.Text = "âœ“"
        statusIcon.TextColor3 = Color3.fromRGB(80, 255, 120)
        statusStroke.Color = Color3.fromRGB(80, 255, 120)
    end
end

-- Auto-refresh every 5 seconds
task.spawn(function()
    while hubGui and hubGui.Parent do
        updateStatusPanel()
        task.wait(5)
    end
end)

-- Initial update
updateStatusPanel()
-- Game grid container
local grid = Instance.new("ScrollingFrame", hubFrame)
grid.Size = UDim2.new(1, -40, 1, -130)
grid.Position = UDim2.new(0, 20, 0, 110)
grid.BackgroundTransparency = 1
grid.BorderSizePixel = 0
grid.ScrollBarThickness = 6
grid.ScrollBarImageColor3 = Color3.fromRGB(130, 80, 200)
grid.CanvasSize = UDim2.new(0, 0, 0, 0)

local layout = Instance.new("UIGridLayout", grid)
layout.CellSize = UDim2.new(0, 190, 0, 110)
layout.CellPadding = UDim2.new(0, 10, 0, 10)
layout.SortOrder = Enum.SortOrder.LayoutOrder

-- Auto-resize canvas
layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    grid.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 10)
end)

for id, data in pairs(supportedGames) do
    local card = Instance.new("TextButton", grid)
    card.BackgroundColor3 = Color3.fromRGB(25, 20, 35)
    card.Text = ""
    card.AutoButtonColor = false
    card.BorderSizePixel = 0
    local cardCorner = Instance.new("UICorner", card)
    cardCorner.CornerRadius = UDim.new(0, 10)
    
    -- Card stroke
    local cardStroke = Instance.new("UIStroke", card)
    cardStroke.Color = id == currentPlaceId and Color3.fromRGB(80, 255, 120) or Color3.fromRGB(70, 60, 90)
    cardStroke.Thickness = 2
    cardStroke.Transparency = id == currentPlaceId and 0 or 0.5
    
    -- Gradient overlay
    local cardGradient = Instance.new("Frame", card)
    cardGradient.Size = UDim2.new(1, 0, 1, 0)
    cardGradient.BackgroundTransparency = 0.7
    cardGradient.BorderSizePixel = 0
    local cgCorner = Instance.new("UICorner", cardGradient)
    cgCorner.CornerRadius = UDim.new(0, 10)
    local cgGradient = Instance.new("UIGradient", cardGradient)
    cgGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, data.color),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 15, 30))
    }
    cgGradient.Rotation = 135
    
    -- Icon
    local icon = Instance.new("TextLabel", card)
    icon.Size = UDim2.new(1, 0, 0, 40)
    icon.Position = UDim2.new(0, 0, 0, 15)
    icon.BackgroundTransparency = 1
    icon.Text = data.icon
    icon.TextColor3 = Color3.fromRGB(255, 255, 255)
    icon.TextSize = 32
    icon.Font = Enum.Font.GothamBold
    icon.ZIndex = 2
    
    -- Game name
    local gameName = Instance.new("TextLabel", card)
    gameName.Size = UDim2.new(1, -10, 0, 35)
    gameName.Position = UDim2.new(0, 5, 0, 55)
    gameName.BackgroundTransparency = 1
    gameName.Text = data.name
    gameName.TextColor3 = Color3.fromRGB(255, 255, 255)
    gameName.TextSize = 11
    gameName.Font = Enum.Font.GothamBold
    gameName.TextWrapped = true
    gameName.TextYAlignment = Enum.TextYAlignment.Top
    gameName.ZIndex = 2
    
    -- Current game badge
    if id == currentPlaceId then
        local badge = Instance.new("Frame", card)
        badge.Size = UDim2.new(0, 80, 0, 20)
        badge.Position = UDim2.new(0.5, -40, 1, -25)
        badge.BackgroundColor3 = Color3.fromRGB(80, 255, 120)
        badge.BorderSizePixel = 0
        badge.ZIndex = 3
        local badgeCorner = Instance.new("UICorner", badge)
        badgeCorner.CornerRadius = UDim.new(0, 5)
        
        local badgeText = Instance.new("TextLabel", badge)
        badgeText.Size = UDim2.new(1, 0, 1, 0)
        badgeText.BackgroundTransparency = 1
        badgeText.Text = "CURRENT"
        badgeText.TextColor3 = Color3.fromRGB(0, 0, 0)
        badgeText.TextSize = 9
        badgeText.Font = Enum.Font.GothamBold
        badgeText.ZIndex = 4
    end
    
    -- Hover effects
    card.MouseEnter:Connect(function()
        TweenService:Create(card, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(35, 30, 45)}):Play()
        TweenService:Create(cardStroke, TweenInfo.new(0.2), {Transparency = 0, Thickness = 3}):Play()
        TweenService:Create(icon, TweenInfo.new(0.2), {TextSize = 36}):Play()
    end)
    
    card.MouseLeave:Connect(function()
        TweenService:Create(card, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(25, 20, 35)}):Play()
        if id ~= currentPlaceId then
            TweenService:Create(cardStroke, TweenInfo.new(0.2), {Transparency = 0.5, Thickness = 2}):Play()
        end
        TweenService:Create(icon, TweenInfo.new(0.2), {TextSize = 32}):Play()
    end)
    
    card.MouseButton1Click:Connect(function()
        if id == currentPlaceId then
            -- Special handling for games with external scripts (MM2, TSB, etc.)
            if data.loadScript then
                -- SET GLOBAL UNLOAD FLAG TO KILL ALL FUNCTIONALITY IMMEDIATELY
                _G.BinxixUnloaded = true
                
                -- Destroy loading screen immediately if it exists
                local playerGui = player:FindFirstChild("PlayerGui")
                if playerGui then
                    local loadingScreen = playerGui:FindFirstChild("BinxixLoadingScreen")
                    if loadingScreen then
                        pcall(function() loadingScreen:Destroy() end)
                    end
                end
                
                -- Disconnect all connections safely (only if they exist and are connected)
                if allConnections then
                    for _, conn in ipairs(allConnections) do
                        pcall(function()
                            if conn and typeof(conn) == "RBXScriptConnection" and conn.Connected then
                                conn:Disconnect()
                            end
                        end)
                    end
                end
                
                -- Destroy ALL Binxix GUIs immediately
                if playerGui then
                    -- Destroy everything with "Binxix" in the name
                    for _, gui in ipairs(playerGui:GetChildren()) do
                        if gui:IsA("ScreenGui") and (gui.Name:find("Binxix") or gui.Name == "AdminPanel") then
                            pcall(function() gui:Destroy() end)
                        end
                    end
                end
                
                -- Destroy hub GUI reference
                pcall(function()
                    if hubGui and hubGui.Parent then
                        hubGui:Destroy()
                    end
                end)
                
                -- Reset character modifications
                pcall(function()
                    if player.Character then
                        local humanoid = player.Character:FindFirstChild("Humanoid")
                        if humanoid then
                            humanoid.WalkSpeed = 16
                            humanoid.JumpPower = 50
                        end
                    end
                end)
                
                -- Show loading notification
                task.wait(0.3)
                local notifGui = Instance.new("ScreenGui")
                notifGui.Name = "ScriptLoader"
                notifGui.ResetOnSpawn = false
                notifGui.IgnoreGuiInset = true
                notifGui.Parent = player:WaitForChild("PlayerGui")
                
                local notifFrame = Instance.new("Frame")
                notifFrame.Size = UDim2.new(0, 320, 0, 80)
                notifFrame.Position = UDim2.new(0.5, -160, 0.5, -40)
                notifFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
                notifFrame.BorderSizePixel = 0
                notifFrame.Parent = notifGui
                Instance.new("UICorner", notifFrame).CornerRadius = UDim.new(0, 10)
                local notifStroke = Instance.new("UIStroke", notifFrame)
                notifStroke.Color = Color3.fromRGB(130, 80, 200)
                notifStroke.Thickness = 2
                
                local notifText = Instance.new("TextLabel")
                notifText.Size = UDim2.new(1, -20, 1, -20)
                notifText.Position = UDim2.new(0, 10, 0, 10)
                notifText.BackgroundTransparency = 1
                notifText.Text = " Loading " .. data.scriptName .. "...\nBinxix GUI Unloaded"
                notifText.TextColor3 = Color3.fromRGB(255, 255, 255)
                notifText.TextSize = 12
                notifText.Font = Enum.Font.GothamBold
                notifText.TextWrapped = true
                notifText.Parent = notifFrame
                
                -- Load the external script
                task.spawn(function()
                    task.wait(0.5)
                    
                    local success, err = pcall(function()
                        local scriptContent = game:HttpGet(data.loadScript)
                        loadstring(scriptContent)()
                    end)
                    
                    if success then
                        notifText.Text = " " .. data.scriptName .. " Loaded!\nBinxix GUI Unloaded"
                        notifFrame.BackgroundColor3 = Color3.fromRGB(20, 40, 20)
                        notifStroke.Color = Color3.fromRGB(80, 255, 120)
                        task.wait(2)
                        notifGui:Destroy()
                    else
                        notifText.Text = " Failed to load " .. data.scriptName .. "\n" .. tostring(err)
                        notifFrame.BackgroundColor3 = Color3.fromRGB(40, 20, 20)
                        notifStroke.Color = Color3.fromRGB(255, 80, 80)
                        task.wait(3)
                        notifGui:Destroy()
                    end
                end)
            else
                hubGui:Destroy()
            end
        else
            TeleportService:Teleport(id, player)
        end
    end)
end

-- UNIVERSAL BUTTON (Always shown at the end)
local universalCard = Instance.new("TextButton", grid)
universalCard.BackgroundColor3 = Color3.fromRGB(25, 20, 35)
universalCard.Text = ""
universalCard.AutoButtonColor = false
universalCard.BorderSizePixel = 0
universalCard.LayoutOrder = 999 -- Ensures it appears last
local univCorner = Instance.new("UICorner", universalCard)
univCorner.CornerRadius = UDim.new(0, 10)

local univStroke = Instance.new("UIStroke", universalCard)
univStroke.Color = Color3.fromRGB(255, 180, 50)
univStroke.Thickness = 2
univStroke.Transparency = 0

-- Warning gradient
local univGradient = Instance.new("Frame", universalCard)
univGradient.Size = UDim2.new(1, 0, 1, 0)
univGradient.BackgroundTransparency = 0.7
univGradient.BorderSizePixel = 0
local univGradCorner = Instance.new("UICorner", univGradient)
univGradCorner.CornerRadius = UDim.new(0, 10)
local univGradUI = Instance.new("UIGradient", univGradient)
univGradUI.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 180, 50)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 15, 30))
}
univGradUI.Rotation = 135

-- Icon
local univIcon = Instance.new("TextLabel", universalCard)
univIcon.Size = UDim2.new(1, 0, 0, 40)
univIcon.Position = UDim2.new(0, 0, 0, 15)
univIcon.BackgroundTransparency = 1
univIcon.Text = ""
univIcon.TextColor3 = Color3.fromRGB(255, 255, 255)
univIcon.TextSize = 32
univIcon.Font = Enum.Font.GothamBold
univIcon.ZIndex = 2

-- Name
local univName = Instance.new("TextLabel", universalCard)
univName.Size = UDim2.new(1, -10, 0, 35)
univName.Position = UDim2.new(0, 5, 0, 55)
univName.BackgroundTransparency = 1
univName.Text = "UNIVERSAL MODE"
univName.TextColor3 = Color3.fromRGB(255, 255, 255)
univName.TextSize = 11
univName.Font = Enum.Font.GothamBold
univName.TextWrapped = true
univName.TextYAlignment = Enum.TextYAlignment.Top
univName.ZIndex = 2

-- Warning badge
local warnBadge = Instance.new("Frame", universalCard)
warnBadge.Size = UDim2.new(0, 80, 0, 20)
warnBadge.Position = UDim2.new(0.5, -40, 1, -25)
warnBadge.BackgroundColor3 = Color3.fromRGB(255, 150, 50)
warnBadge.BorderSizePixel = 0
warnBadge.ZIndex = 3
local warnCorner = Instance.new("UICorner", warnBadge)
warnCorner.CornerRadius = UDim.new(0, 5)

local warnText = Instance.new("TextLabel", warnBadge)
warnText.Size = UDim2.new(1, 0, 1, 0)
warnText.BackgroundTransparency = 1
warnText.Text = " UNTESTED"
warnText.TextColor3 = Color3.fromRGB(0, 0, 0)
warnText.TextSize = 8
warnText.Font = Enum.Font.GothamBold
warnText.ZIndex = 4

-- Hover effects
universalCard.MouseEnter:Connect(function()
    TweenService:Create(universalCard, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(35, 30, 45)}):Play()
    TweenService:Create(univStroke, TweenInfo.new(0.2), {Transparency = 0, Thickness = 3}):Play()
    TweenService:Create(univIcon, TweenInfo.new(0.2), {TextSize = 36}):Play()
end)

universalCard.MouseLeave:Connect(function()
    TweenService:Create(universalCard, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(25, 20, 35)}):Play()
    TweenService:Create(univStroke, TweenInfo.new(0.2), {Transparency = 0, Thickness = 2}):Play()
    TweenService:Create(univIcon, TweenInfo.new(0.2), {TextSize = 32}):Play()
end)

universalCard.MouseButton1Click:Connect(function()
    hubGui:Destroy()
    
    -- Show "Game Not Tested" warning notification
    showNotification(
        " Universal Mode",
        "Place ID: " .. tostring(currentPlaceId) .. "\n\nThis game hasn't been tested. Some features may not work properly.",
        5,
        true
    )
    
    -- Small delay to show notification
    task.wait(0.5)
end)
-- ============================================
-- REMOTE STATUS FETCHER (AUTO-UPDATE)
-- ============================================
task.spawn(function()
    local HttpService = game:GetService("HttpService")
    local STATUS_URL = ""
    
    local function fetchRemoteStatus()
        local success, result = pcall(function()
            local response = game:HttpGet(STATUS_URL)
            local data = HttpService:JSONDecode(response)
            
            _G.BinxixStatus = {
                message = data.message or "All systems operational",
                color = Color3.fromRGB(
                    data.color and data.color.r or 80,
                    data.color and data.color.g or 255,
                    data.color and data.color.b or 120
                ),
                updateAvailable = data.updateAvailable or false,
                maintenanceMode = data.maintenanceMode or false,
                customAnnouncement = data.customAnnouncement or nil
            }
        end)
        
        if not success then
            _G.BinxixStatus = {
                message = "All systems operational",
                color = Color3.fromRGB(80, 255, 120),
                updateAvailable = false,
                maintenanceMode = false,
                customAnnouncement = nil
            }
        end
    end
    
    -- Initial fetch
    fetchRemoteStatus()
    
    -- Auto-refresh every 60 seconds
    while true do
        task.wait(60)
        fetchRemoteStatus()
    end
end)
repeat task.wait() until not hubGui.Parent

-- Show loading notification
showNotification(
    " Loading " .. currentGameData.name,
    "Binxix's GUI V5 is initializing...",
    3,
    false
)

print(" Loading "..currentGameData.name.."...")

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local activeTracking = {}
local activeESP = {}
local espEnabled = {}
local rightMouseTracking = {}
local espSettings = {}
local trackingMode = {}
local toggleTrackingActive = {}
local camTrackingSettings = {}

local bunnyHopEnabled = {}
local fullbrightEnabled = {}
local noFogEnabled = {}
local crosshairEnabled = {}
local crosshairSettings = {}
local originalLighting = {}
local originalFog = {}

local aimlockSettings = {}
local fovCircleEnabled = {}

local flyEnabled = {}
local flySpeed = {}
local noclipEnabled = {}
local bodyVelocity = {}
local bodyGyro = {}

-- Admin features
local invisEnabled = {}
local godModeEnabled = {}
local walkflingEnabled = {}
local walkableEnabled = {}
local sitflingEnabled = {}

local keybinds = {}
local waitingForKeybind = {}
local keybindCallbacks = {}

-- Unload system
local allConnections = {}
local guiInstances = {}
local isUnloading = false

local Colors = {
    Background = Color3.fromRGB(20, 20, 25),
    BackgroundLight = Color3.fromRGB(30, 30, 38),
    Accent = Color3.fromRGB(130, 80, 200),
    AccentBright = Color3.fromRGB(160, 100, 255),
    Border = Color3.fromRGB(50, 50, 60),
    Text = Color3.fromRGB(220, 220, 230),
    TextDim = Color3.fromRGB(120, 120, 130),
    ESP_Close = Color3.fromRGB(255, 60, 60),
    ESP_Medium = Color3.fromRGB(255, 180, 50),
    ESP_Far = Color3.fromRGB(255, 255, 80),
    ESP_VeryFar = Color3.fromRGB(80, 255, 80),
    ESP_Visible = Color3.fromRGB(0, 255, 200),
    ESP_Hidden = Color3.fromRGB(255, 80, 80),
    Health_High = Color3.fromRGB(80, 255, 80),
    Health_Mid = Color3.fromRGB(255, 200, 50),
    Health_Low = Color3.fromRGB(255, 60, 60),
    Unload = Color3.fromRGB(255, 80, 80),
}

local SKELETON_CONNECTIONS = {
    {"Head", "UpperTorso"}, {"UpperTorso", "LowerTorso"},
    {"UpperTorso", "LeftUpperArm"}, {"LeftUpperArm", "LeftLowerArm"}, {"LeftLowerArm", "LeftHand"},
    {"UpperTorso", "RightUpperArm"}, {"RightUpperArm", "RightLowerArm"}, {"RightLowerArm", "RightHand"},
    {"LowerTorso", "LeftUpperLeg"}, {"LeftUpperLeg", "LeftLowerLeg"}, {"LeftLowerLeg", "LeftFoot"},
    {"LowerTorso", "RightUpperLeg"}, {"RightUpperLeg", "RightLowerLeg"}, {"RightLowerLeg", "RightFoot"},
}

local SKELETON_R6 = {
    {"Head", "Torso"}, {"Torso", "Left Arm"}, {"Torso", "Right Arm"}, {"Torso", "Left Leg"}, {"Torso", "Right Leg"},
}

local function isSameTeam(player1, player2)
    if not player1.Team or not player2.Team then return false end
    return player1.Team == player2.Team
end

local function isValidTarget(admin, target)
    if target == admin then return false end
    if isSameTeam(admin, target) then return false end
    return true
end

local function hasLineOfSight(admin, target)
    local adminChar = admin.Character
    local targetChar = target.Character
    if not adminChar or not targetChar then return false end
    local adminHead = adminChar:FindFirstChild("Head")
    local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
    if not adminHead or not targetHRP then return false end
    local origin = adminHead.Position
    local direction = (targetHRP.Position - origin)
    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Exclude
    raycastParams.FilterDescendantsInstances = {adminChar, targetChar}
    raycastParams.IgnoreWater = true
    local raycastResult = Workspace:Raycast(origin, direction, raycastParams)
    return raycastResult == nil
end

local function isInFOV(admin, target, fovRadius)
    local camera = Workspace.CurrentCamera
    if not camera then return false end
    local targetChar = target.Character
    if not targetChar then return false end
    local settings = camTrackingSettings[admin.UserId] or {}
    local lockPart = settings.lockPart or "Head"
    local targetPart = targetChar:FindFirstChild(lockPart) or targetChar:FindFirstChild("Head") or targetChar:FindFirstChild("HumanoidRootPart")
    if not targetPart then return false end
    local screenPos, onScreen = camera:WorldToViewportPoint(targetPart.Position)
    if not onScreen or screenPos.Z < 0 then return false end
    local screenCenter = camera.ViewportSize / 2
    local targetScreenPos = Vector2.new(screenPos.X, screenPos.Y)
    local distanceFromCenter = (targetScreenPos - screenCenter).Magnitude
    return distanceFromCenter <= fovRadius
end

local function getNearestValidTarget(admin, useFOV)
    local adminChar = admin.Character
    if not adminChar then return nil end
    local adminHRP = adminChar:FindFirstChild("HumanoidRootPart")
    if not adminHRP then return nil end
    local settings = aimlockSettings[admin.UserId] or {}
    local fovRadius = settings.fovRadius or 150
    local requireLOS = settings.requireLOS ~= false
    local nearestPlayer, nearestScreenDistance = nil, math.huge
    local camera = Workspace.CurrentCamera
    if not camera then return nil end
    local screenCenter = camera.ViewportSize / 2
    for _, player in ipairs(Players:GetPlayers()) do
        if isValidTarget(admin, player) then
            local char = player.Character
            if char then
                local lockPartName = (camTrackingSettings[admin.UserId] or {}).lockPart or "Head"
                local targetPart = char:FindFirstChild(lockPartName) or char:FindFirstChild("Head") or char:FindFirstChild("HumanoidRootPart")
                if targetPart then
                    local screenPos, onScreen = camera:WorldToViewportPoint(targetPart.Position)
                    if onScreen and screenPos.Z > 0 then
                        local targetScreenPos = Vector2.new(screenPos.X, screenPos.Y)
                        local screenDistance = (targetScreenPos - screenCenter).Magnitude
                        if useFOV and screenDistance > fovRadius then continue end
                        if requireLOS and not hasLineOfSight(admin, player) then continue end
                        if screenDistance < nearestScreenDistance then
                            nearestScreenDistance = screenDistance
                            nearestPlayer = player
                        end
                    end
                end
            end
        end
    end
    return nearestPlayer, nearestScreenDistance
end

local function stopRightMouseTracking(admin)
    if rightMouseTracking[admin.UserId] then
        if rightMouseTracking[admin.UserId].connection then
            rightMouseTracking[admin.UserId].connection:Disconnect()
        end
        rightMouseTracking[admin.UserId] = nil
        return true
    end
    return false
end

local function getESPColor(distance)
    if distance < 30 then return Colors.ESP_Close
    elseif distance < 75 then return Colors.ESP_Medium
    elseif distance < 150 then return Colors.ESP_Far
    else return Colors.ESP_VeryFar end
end

local function getHealthColor(percent)
    if percent > 0.6 then return Colors.Health_High
    elseif percent > 0.3 then return Colors.Health_Mid
    else return Colors.Health_Low end
end

local function enableFullbright(player)
    if not originalLighting[player.UserId] then
        originalLighting[player.UserId] = {
            Ambient = Lighting.Ambient, Brightness = Lighting.Brightness,
            OutdoorAmbient = Lighting.OutdoorAmbient, GlobalShadows = Lighting.GlobalShadows,
        }
    end
    Lighting.Ambient = Color3.fromRGB(255, 255, 255)
    Lighting.Brightness = 2
    Lighting.OutdoorAmbient = Color3.fromRGB(255, 255, 255)
    Lighting.GlobalShadows = false
    for _, effect in ipairs(Lighting:GetChildren()) do
        if effect:IsA("ColorCorrectionEffect") then effect.Enabled = false end
    end
end

local function disableFullbright(player)
    if originalLighting[player.UserId] then
        Lighting.Ambient = originalLighting[player.UserId].Ambient
        Lighting.Brightness = originalLighting[player.UserId].Brightness
        Lighting.OutdoorAmbient = originalLighting[player.UserId].OutdoorAmbient
        Lighting.GlobalShadows = originalLighting[player.UserId].GlobalShadows
        for _, effect in ipairs(Lighting:GetChildren()) do
            if effect:IsA("ColorCorrectionEffect") then effect.Enabled = true end
        end
    end
end

local function enableNoFog(player)
    if not originalFog[player.UserId] then
        originalFog[player.UserId] = {
            FogStart = Lighting.FogStart, FogEnd = Lighting.FogEnd, FogColor = Lighting.FogColor,
        }
    end
    Lighting.FogStart = 100000
    Lighting.FogEnd = 100000
    for _, effect in ipairs(Lighting:GetChildren()) do
        if effect:IsA("Atmosphere") then effect.Density = 0 end
    end
end

local function disableNoFog(player)
    if originalFog[player.UserId] then
        Lighting.FogStart = originalFog[player.UserId].FogStart
        Lighting.FogEnd = originalFog[player.UserId].FogEnd
        Lighting.FogColor = originalFog[player.UserId].FogColor
        for _, effect in ipairs(Lighting:GetChildren()) do
            if effect:IsA("Atmosphere") then effect.Density = 0.3 end
        end
    end
end

local function worldToScreen(position)
    local camera = Workspace.CurrentCamera
    if not camera then return nil, false end
    local screenPos, onScreen = camera:WorldToViewportPoint(position)
    return Vector2.new(screenPos.X, screenPos.Y), onScreen and screenPos.Z > 0
end

local function drawLine(frame, p1, p2, thickness, color)
    local distance = (p2 - p1).Magnitude
    local center = (p1 + p2) / 2
    local angle = math.atan2(p2.Y - p1.Y, p2.X - p1.X)
    frame.Size = UDim2.new(0, distance, 0, thickness)
    frame.Position = UDim2.new(0, center.X, 0, center.Y)
    frame.Rotation = math.deg(angle)
    frame.BackgroundColor3 = color
    frame.Visible = true
end
-- Line ~1566
local function getHealthColor(percent)
    if percent > 0.6 then return Colors.Health_High
    elseif percent > 0.3 then return Colors.Health_Mid
    else return Colors.Health_Low end
end

local function clearAllESP(admin)
    if activeESP[admin.UserId] then
        for userId, data in pairs(activeESP[admin.UserId]) do
            if data.components then
                if data.components.folder then 
                    pcall(function() data.components.folder:Destroy() end)
                end
                if data.components.drawingFrame then 
                    pcall(function() data.components.drawingFrame:Destroy() end)
                end
            end
        end
        activeESP[admin.UserId] = {}
    end
    espEnabled[admin.UserId] = false
end

local espCache = {}
local espUpdateRate = 0 -- ~30 FPS for ESP updates (instead of 60)
local lastESPUpdate = 0
local maxESPDistance = 2000 -- Don't show ESP beyond this distance

-- Pooling system to reuse GUI elements
local function getOrCreateLine(parent)
    local line = Instance.new("Frame")
    line.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    line.BorderSizePixel = 0
    line.AnchorPoint = Vector2.new(0.5, 0.5)
    line.Visible = false
    line.Parent = parent
    return line
end

local function createOptimizedESP(target, admin, screenGui)
    if not target.Character then return nil end
    if not isValidTarget(admin, target) then return nil end
    
    local existingFolder = target.Character:FindFirstChild("AdminESP_" .. admin.UserId)
    if existingFolder then existingFolder:Destroy() end
    
    local espFolder = Instance.new("Folder")
    espFolder.Name = "AdminESP_" .. admin.UserId
    espFolder.Parent = target.Character
    
    -- Single drawing frame for ALL ESP elements
    local drawingFrame = Instance.new("Frame")
    drawingFrame.Name = "ESPDrawing_" .. target.UserId
    drawingFrame.Size = UDim2.new(1, 0, 1, 0)
    drawingFrame.BackgroundTransparency = 1
    drawingFrame.ZIndex = 1
    drawingFrame.Parent = screenGui
    
    -- Billboard (optimized with single update)
    local billboardGui = Instance.new("BillboardGui")
    billboardGui.Name = "InfoBoard"
    billboardGui.Adornee = target.Character:FindFirstChild("Head")
    billboardGui.Size = UDim2.new(0, 150, 0, 60)
    billboardGui.StudsOffset = Vector3.new(0, 2.5, 0)
    billboardGui.AlwaysOnTop = true
    billboardGui.MaxDistance = maxESPDistance
    billboardGui.Parent = espFolder
    
    -- Container frame for billboard elements
    local infoContainer = Instance.new("Frame")
    infoContainer.Size = UDim2.new(1, 0, 1, 0)
    infoContainer.BackgroundTransparency = 1
    infoContainer.Parent = billboardGui
    
    -- Gradient background for name
    local nameBg = Instance.new("Frame")
    nameBg.Size = UDim2.new(1, 10, 0, 18)
    nameBg.Position = UDim2.new(0, -5, 0, 0)
    nameBg.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
    nameBg.BackgroundTransparency = 0.3
    nameBg.BorderSizePixel = 0
    nameBg.Parent = infoContainer
    local nameBgCorner = Instance.new("UICorner")
    nameBgCorner.CornerRadius = UDim.new(0, 4)
    nameBgCorner.Parent = nameBg
    local nameBgStroke = Instance.new("UIStroke")
    nameBgStroke.Color = Color3.fromRGB(130, 80, 200)
    nameBgStroke.Thickness = 1
    nameBgStroke.Transparency = 0.7
    nameBgStroke.Parent = nameBg
    
    -- Name label
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Name = "NameLabel"
    nameLabel.Size = UDim2.new(1, 0, 1, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = target.Name
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextStrokeTransparency = 0
    nameLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    nameLabel.TextSize = 13
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.Parent = nameBg
    
    -- Distance label with glow effect
    local distanceLabel = Instance.new("TextLabel")
    distanceLabel.Name = "DistanceLabel"
    distanceLabel.Size = UDim2.new(1, 0, 0, 14)
    distanceLabel.Position = UDim2.new(0, 0, 0, 20)
    distanceLabel.BackgroundTransparency = 1
    distanceLabel.Text = "[0m]"
    distanceLabel.TextColor3 = Colors.ESP_Far
    distanceLabel.TextStrokeTransparency = 0
    distanceLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
    distanceLabel.TextSize = 11
    distanceLabel.Font = Enum.Font.GothamBold
    distanceLabel.Parent = infoContainer
    
    -- Modern health bar with gradient
    local healthBarBg = Instance.new("Frame")
    healthBarBg.Name = "HealthBarBg"
    healthBarBg.Size = UDim2.new(0, 4, 0, 30)
    healthBarBg.Position = UDim2.new(0, -10, 0, 5)
    healthBarBg.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    healthBarBg.BackgroundTransparency = 0.2
    healthBarBg.BorderSizePixel = 0
    healthBarBg.Parent = infoContainer
    local healthBgCorner = Instance.new("UICorner")
    healthBgCorner.CornerRadius = UDim.new(1, 0)
    healthBgCorner.Parent = healthBarBg
    local healthBgStroke = Instance.new("UIStroke")
    healthBgStroke.Color = Color3.fromRGB(50, 50, 60)
    healthBgStroke.Thickness = 1
    healthBgStroke.Parent = healthBarBg
    
    local healthBarFill = Instance.new("Frame")
    healthBarFill.Name = "HealthBarFill"
    healthBarFill.Size = UDim2.new(1, 0, 1, 0)
    healthBarFill.AnchorPoint = Vector2.new(0, 1)
    healthBarFill.Position = UDim2.new(0, 0, 1, 0)
    healthBarFill.BackgroundColor3 = Colors.Health_High
    healthBarFill.BorderSizePixel = 0
    healthBarFill.Parent = healthBarBg
    local healthFillCorner = Instance.new("UICorner")
    healthFillCorner.CornerRadius = UDim.new(1, 0)
    healthFillCorner.Parent = healthBarFill
    
    -- Health gradient
    local healthGradient = Instance.new("UIGradient")
    healthGradient.Rotation = 90
    healthGradient.Parent = healthBarFill
    
    -- Skeleton (pre-create but keep minimal)
    local skeletonParts = {}
    local isR15 = target.Character:FindFirstChild("UpperTorso") ~= nil
    local bones = isR15 and SKELETON_CONNECTIONS or SKELETON_R6
    
    for i = 1, math.min(#bones, 8) do -- Limit skeleton bones for performance
        local line = getOrCreateLine(drawingFrame)
        table.insert(skeletonParts, {line = line, part1 = bones[i][1], part2 = bones[i][2]})
    end
    
    -- Box corners (8 lines total)
    local cornerLines = {}
    for i = 1, 8 do
        cornerLines[i] = getOrCreateLine(drawingFrame)
    end
    
    -- Single tracer line
    local tracerLine = getOrCreateLine(drawingFrame)
    tracerLine.ZIndex = 1
    
    -- Head dot with glow
    local headDot = Instance.new("Frame")
    headDot.Name = "HeadDot"
   headDot.Size = UDim2.new(0, 4, 0, 4)
    headDot.BackgroundColor3 = Colors.ESP_Close
    headDot.BorderSizePixel = 0
    headDot.Visible = false
    headDot.AnchorPoint = Vector2.new(0.5, 0.5)
    headDot.Parent = drawingFrame
    local headDotCorner = Instance.new("UICorner")
    headDotCorner.CornerRadius = UDim.new(1, 0)
    headDotCorner.Parent = headDot
    local headDotGlow = Instance.new("UIStroke")
    headDotGlow.Color = Color3.fromRGB(255, 255, 255)
    headDotGlow.Thickness = 1
    headDotGlow.Transparency = 0.5
    headDotGlow.Parent = headDot
    
    -- Offscreen indicator (simplified)
    local arrowFrame = Instance.new("ImageLabel")
    arrowFrame.Name = "ArrowIndicator"
    arrowFrame.Size = UDim2.new(0, 20, 0, 20)
    arrowFrame.BackgroundTransparency = 1
    arrowFrame.Image = "rbxassetid://7072706068" -- Triangle arrow
    arrowFrame.ImageColor3 = Colors.ESP_Close
    arrowFrame.Visible = false
    arrowFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    arrowFrame.Parent = drawingFrame
    
    return {
        folder = espFolder,
        drawingFrame = drawingFrame,
        billboard = billboardGui,
        nameLabel = nameLabel,
        nameBg = nameBg,
        nameBgStroke = nameBgStroke,
        distanceLabel = distanceLabel,
        healthBarBg = healthBarBg,
        healthBarFill = healthBarFill,
        healthGradient = healthGradient,
        skeletonParts = skeletonParts,
        cornerLines = cornerLines,
        tracerLine = tracerLine,
        headDot = headDot,
        headDotGlow = headDotGlow,
        arrowFrame = arrowFrame,
        isR15 = isR15,
        bones = bones,
        lastDistance = 0
    }
end

local function updateOptimizedESP(admin, target, espComponents)
    if not admin.Character or not target.Character then return false end
    if not isValidTarget(admin, target) then
        if espComponents.folder then espComponents.folder:Destroy() end
        if espComponents.drawingFrame then espComponents.drawingFrame:Destroy() end
        return false
    end
    
    local adminHRP = admin.Character:FindFirstChild("HumanoidRootPart")
    local targetHRP = target.Character:FindFirstChild("HumanoidRootPart")
    local targetHead = target.Character:FindFirstChild("Head")
    local targetHumanoid = target.Character:FindFirstChild("Humanoid")
    
    if not adminHRP or not targetHRP then return true end
    
    local camera = Workspace.CurrentCamera
    if not camera then return true end
    
    local distance = (adminHRP.Position - targetHRP.Position).Magnitude
    
    -- Distance culling for performance
    if distance > maxESPDistance then
        espComponents.drawingFrame.Visible = false
        espComponents.billboard.Enabled = false
        return true
    end
    
    espComponents.drawingFrame.Visible = true
    espComponents.billboard.Enabled = true
    
    local canSee = hasLineOfSight(admin, target)
    local espColor = getESPColor(distance)
    local settings = espSettings[admin.UserId] or {}
    
    -- Update name with glow effect
    if espComponents.nameLabel then
        espComponents.nameLabel.Visible = settings.nameEnabled ~= false
        espComponents.nameBg.Visible = settings.nameEnabled ~= false
        espComponents.nameLabel.TextColor3 = canSee and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(180, 180, 180)
        espComponents.nameBgStroke.Color = espColor
    end
    
    -- Update distance (only if changed significantly)
    if espComponents.distanceLabel and settings.distanceEnabled ~= false then
        local distRounded = math.floor(distance / 5) * 5 -- Round to nearest 5
        if math.abs(distRounded - espComponents.lastDistance) >= 5 then
            espComponents.distanceLabel.Text = string.format("[%dm]", distRounded)
            espComponents.distanceLabel.TextColor3 = espColor
            espComponents.lastDistance = distRounded
        end
        espComponents.distanceLabel.Visible = true
    else
        if espComponents.distanceLabel then
            espComponents.distanceLabel.Visible = false
        end
    end
    
    -- Update health bar with smooth animation
    if targetHumanoid and espComponents.healthBarFill and settings.healthEnabled ~= false then
        local healthPercent = math.clamp(targetHumanoid.Health / targetHumanoid.MaxHealth, 0, 1)
        
        -- Smooth tween instead of instant update
        TweenService:Create(
            espComponents.healthBarFill,
            TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {Size = UDim2.new(1, 0, healthPercent, 0)}
        ):Play()
        
        local healthColor = getHealthColor(healthPercent)
        espComponents.healthBarFill.BackgroundColor3 = healthColor
        
        -- Update gradient
        espComponents.healthGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, healthColor),
            ColorSequenceKeypoint.new(1, Color3.new(
                healthColor.R * 0.6,
                healthColor.G * 0.6,
                healthColor.B * 0.6
            ))
        }
        
        espComponents.healthBarBg.Visible = true
    else
        if espComponents.healthBarBg then
            espComponents.healthBarBg.Visible = false
        end
    end
    
-- Update box (only if enabled and on screen)
if settings.boxEnabled ~= false then
    if targetHead and targetHRP then
        -- Get character bounding box using actual parts
        local char = target.Character
        if char then
            -- Find all visible parts to calculate bounds
            local minX, maxX = math.huge, -math.huge
            local minY, maxY = math.huge, -math.huge
            local validParts = 0
            
            for _, part in ipairs(char:GetChildren()) do
                if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                    local partPos, onScreen = worldToScreen(part.Position)
                    if onScreen and partPos then
                        local size = part.Size
                        local offset = size.Magnitude / 2
                        
                        minX = math.min(minX, partPos.X - offset)
                        maxX = math.max(maxX, partPos.X + offset)
                        minY = math.min(minY, partPos.Y - offset)
                        maxY = math.max(maxY, partPos.Y + offset)
                        validParts = validParts + 1
                    end
                end
            end
            
            -- If we found valid parts, draw the box
            if validParts > 0 and minX < maxX and minY < maxY then
                local width = maxX - minX
                local height = maxY - minY
                local boxThickness = settings.boxThickness or 2
                
                -- FULL BOX (4 sides)
                -- Top line
                espComponents.cornerLines[1].Size = UDim2.new(0, width, 0, boxThickness)
                espComponents.cornerLines[1].Position = UDim2.new(0, minX, 0, minY)
                espComponents.cornerLines[1].BackgroundColor3 = espColor
                espComponents.cornerLines[1].Rotation = 0
                espComponents.cornerLines[1].AnchorPoint = Vector2.new(0, 0)
                espComponents.cornerLines[1].Visible = true
                
                -- Bottom line
                espComponents.cornerLines[2].Size = UDim2.new(0, width, 0, boxThickness)
                espComponents.cornerLines[2].Position = UDim2.new(0, minX, 0, maxY - boxThickness)
                espComponents.cornerLines[2].BackgroundColor3 = espColor
                espComponents.cornerLines[2].Rotation = 0
                espComponents.cornerLines[2].AnchorPoint = Vector2.new(0, 0)
                espComponents.cornerLines[2].Visible = true
                
                -- Left line
                espComponents.cornerLines[3].Size = UDim2.new(0, boxThickness, 0, height)
                espComponents.cornerLines[3].Position = UDim2.new(0, minX, 0, minY)
                espComponents.cornerLines[3].BackgroundColor3 = espColor
                espComponents.cornerLines[3].Rotation = 0
                espComponents.cornerLines[3].AnchorPoint = Vector2.new(0, 0)
                espComponents.cornerLines[3].Visible = true
                
                -- Right line
                espComponents.cornerLines[4].Size = UDim2.new(0, boxThickness, 0, height)
                espComponents.cornerLines[4].Position = UDim2.new(0, maxX - boxThickness, 0, minY)
                espComponents.cornerLines[4].BackgroundColor3 = espColor
                espComponents.cornerLines[4].Rotation = 0
                espComponents.cornerLines[4].AnchorPoint = Vector2.new(0, 0)
                espComponents.cornerLines[4].Visible = true
                
                -- Hide unused corner lines
                for i = 5, 8 do
                    espComponents.cornerLines[i].Visible = false
                end
            else
                for _, line in ipairs(espComponents.cornerLines) do
                    line.Visible = false
                end
            end
        else
            for _, line in ipairs(espComponents.cornerLines) do
                line.Visible = false
            end
        end
    else
        for _, line in ipairs(espComponents.cornerLines) do
            line.Visible = false
        end
    end
else
    for _, line in ipairs(espComponents.cornerLines) do
        line.Visible = false
    end
end
    -- Update skeleton (simplified for performance)
    if settings.skeletonEnabled and distance < 150 then -- Only show skeleton when close
        for _, bone in ipairs(espComponents.skeletonParts) do
            local part1 = target.Character:FindFirstChild(bone.part1)
            local part2 = target.Character:FindFirstChild(bone.part2)
            
            if part1 and part2 then
                local pos1, onScreen1 = worldToScreen(part1.Position)
                local pos2, onScreen2 = worldToScreen(part2.Position)
                
                if onScreen1 and onScreen2 then
                    drawLine(bone.line, pos1, pos2, settings.skeletonThickness or 2, espColor)
                else
                    bone.line.Visible = false
                end
            else
                bone.line.Visible = false
            end
        end
    else
        for _, bone in ipairs(espComponents.skeletonParts) do
            bone.line.Visible = false
        end
    end
    
    -- Update tracer
    if settings.tracerEnabled ~= false then
        local targetPos, onScreen = worldToScreen(targetHRP.Position)
        local screenSize = camera.ViewportSize
        local startPos = Vector2.new(screenSize.X / 2, screenSize.Y)
        
        if settings.tracerOrigin == "Top" then
            startPos = Vector2.new(screenSize.X / 2, 0)
        elseif settings.tracerOrigin == "Mouse" then
            local mouse = admin:GetMouse()
            startPos = Vector2.new(mouse.X, mouse.Y)
        end
        
        if onScreen and targetPos then
            drawLine(espComponents.tracerLine, startPos, targetPos, settings.tracerThickness or 2, espColor)
        else
            espComponents.tracerLine.Visible = false
        end
    else
        espComponents.tracerLine.Visible = false
    end
    
    -- Update head dot with glow
    if settings.headDotEnabled ~= false and targetHead then
        local headScreenPos, onScreen = worldToScreen(targetHead.Position)
        
        if onScreen and headScreenPos then
            espComponents.headDot.Position = UDim2.new(0, headScreenPos.X, 0, headScreenPos.Y)
            espComponents.headDot.BackgroundColor3 = canSee and Colors.ESP_Visible or Colors.ESP_Hidden
            espComponents.headDotGlow.Color = canSee and Colors.ESP_Visible or Colors.ESP_Hidden
            espComponents.headDot.Visible = true
        else
            espComponents.headDot.Visible = false
        end
    else
        espComponents.headDot.Visible = false
    end
    
    -- Update offscreen arrow (simplified)
    if settings.offscreenArrows then
        local targetPos, onScreen = worldToScreen(targetHRP.Position)
        
        if not onScreen and distance < (settings.arrowDistance or 300) then
            local screenSize = camera.ViewportSize
            local screenCenter = Vector2.new(screenSize.X / 2, screenSize.Y / 2)
            local camCF = camera.CFrame
            local targetDirection = (targetHRP.Position - camCF.Position).Unit
            
            local x = targetDirection:Dot(camCF.RightVector)
            local y = targetDirection:Dot(camCF.UpVector)
            local angle = math.atan2(y, x)
            
            local arrowDist = math.min(screenSize.X, screenSize.Y) / 2 - 60
            local arrowX = math.clamp(screenCenter.X + math.cos(angle) * arrowDist, 40, screenSize.X - 40)
            local arrowY = math.clamp(screenCenter.Y - math.sin(angle) * arrowDist, 40, screenSize.Y - 40)
            
            espComponents.arrowFrame.Position = UDim2.new(0, arrowX, 0, arrowY)
            espComponents.arrowFrame.Rotation = -math.deg(angle) + 90
            espComponents.arrowFrame.ImageColor3 = espColor
            espComponents.arrowFrame.Visible = true
        else
            espComponents.arrowFrame.Visible = false
        end
    else
        espComponents.arrowFrame.Visible = false
    end
    
    return true
end

-- OPTIMIZED enableESP with single RenderStepped connection
local function enableESP(admin, screenGui)
    clearAllESP(admin)
    activeESP[admin.UserId] = {}
    espEnabled[admin.UserId] = true
    
    local function setupESPForTarget(target)
        if isValidTarget(admin, target) and target.Character then
            local components = createOptimizedESP(target, admin, screenGui)
            if components then
                activeESP[admin.UserId][target.UserId] = {components = components}
            end
        end
    end
    
    -- Setup ESP for all players
    for _, target in ipairs(Players:GetPlayers()) do
        setupESPForTarget(target)
    end
    
    -- SINGLE RenderStepped connection for ALL players
    local espUpdateConnection = RunService.RenderStepped:Connect(function()
        if isUnloading or _G.BinxixUnloaded then return end
        if not espEnabled[admin.UserId] then return end
        
        -- Update all ESP in single loop
        for userId, data in pairs(activeESP[admin.UserId]) do
            local target = Players:GetPlayerByUserId(userId)
            if target and data.components then
                local stillValid = updateOptimizedESP(admin, target, data.components)
                if not stillValid then
                    activeESP[admin.UserId][userId] = nil
                end
            else
                -- Clean up if player left
                if data.components then
                    if data.components.folder then data.components.folder:Destroy() end
                    if data.components.drawingFrame then data.components.drawingFrame:Destroy() end
                end
                activeESP[admin.UserId][userId] = nil
            end
        end
    end)
    
    table.insert(allConnections, espUpdateConnection)
    
    -- Handle new players
    local playerAddedConn = Players.PlayerAdded:Connect(function(target)
        if isUnloading or _G.BinxixUnloaded then return end
        if not espEnabled[admin.UserId] then return end
        target.CharacterAdded:Wait()
        task.wait(1)
        setupESPForTarget(target)
    end)
    table.insert(allConnections, playerAddedConn)
    
    -- Handle respawns
    for _, target in ipairs(Players:GetPlayers()) do
        if target ~= admin then
            local charAddedConn = target.CharacterAdded:Connect(function()
                if isUnloading or _G.BinxixUnloaded then return end
                if espEnabled[admin.UserId] then
                    task.wait(1)
                    -- Clean up old ESP
                    if activeESP[admin.UserId] and activeESP[admin.UserId][target.UserId] then
                        local oldData = activeESP[admin.UserId][target.UserId]
                        if oldData.components then
                            if oldData.components.folder then oldData.components.folder:Destroy() end
                            if oldData.components.drawingFrame then oldData.components.drawingFrame:Destroy() end
                        end
                    end
                    -- Create new ESP
                    setupESPForTarget(target)
                end
            end)
            table.insert(allConnections, charAddedConn)
        end
    end
end

-- UNLOAD FUNCTION
local function unloadScript(player)
    isUnloading = true
    for _, conn in ipairs(allConnections) do
        pcall(function() conn:Disconnect() end)
    end
    allConnections = {}
    clearAllESP(player)
    stopRightMouseTracking(player)
    local char = player.Character
    if char then
        local humanoid = char:FindFirstChild("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = 16
            humanoid.JumpPower = 50
            humanoid.PlatformStand = false
        end
        if bodyVelocity[player.UserId] then bodyVelocity[player.UserId]:Destroy(); bodyVelocity[player.UserId] = nil end
        if bodyGyro[player.UserId] then bodyGyro[player.UserId]:Destroy(); bodyGyro[player.UserId] = nil end
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = true end
        end
        -- Reset visibility
        for _, part in ipairs(char:GetDescendants()) do
            if part:IsA("BasePart") or part:IsA("Decal") then
                part.Transparency = 0
            end
        end
    end
    disableFullbright(player)
    disableNoFog(player)
    local camera = Workspace.CurrentCamera
    if camera then camera.FieldOfView = 70 end
    bunnyHopEnabled[player.UserId] = false
    fullbrightEnabled[player.UserId] = false
    noFogEnabled[player.UserId] = false
    crosshairEnabled[player.UserId] = false
    flyEnabled[player.UserId] = false
    noclipEnabled[player.UserId] = false
    invisEnabled[player.UserId] = false
    godModeEnabled[player.UserId] = false
    walkflingEnabled[player.UserId] = false
    for _, gui in ipairs(guiInstances) do
        pcall(function() gui:Destroy() end)
    end
    guiInstances = {}
    local playerGui = player:FindFirstChild("PlayerGui")
    if playerGui then
        local adminPanel = playerGui:FindFirstChild("AdminPanel")
        if adminPanel then adminPanel:Destroy() end
    end
    print("Binxix's GUI V5 has been unloaded!")
end

-- Continue with part 2...

-- ============================================
-- BINXIX'S GUI V5 - PART 2 (GUI + ADMIN TAB)
-- ============================================

local function createAdminGui(player)
    espSettings[player.UserId] = {
        boxEnabled = true, tracerEnabled = true, nameEnabled = true, healthEnabled = true,
        distanceEnabled = true, skeletonEnabled = true, headDotEnabled = true,
        tracerThickness = 1, boxThickness = 1, skeletonThickness = 1,
        tracerOrigin = "Bottom", offscreenArrows = true, arrowSize = 15, arrowDistance = 200
    }
    camTrackingSettings[player.UserId] = { smoothness = 0.15, lockPart = "Head", prediction = false }
    aimlockSettings[player.UserId] = {
        fovRadius = 150, fovEnabled = true, showFOVCircle = true, requireLOS = true, fovOpacity = 0.5,
        aimPart = "Head", smoothness = 0.15, prediction = true, predictionAmount = 0.12,
        stickyAim = true, stickyStrength = 0.8, targetSwitchDelay = 0.2,
        priorityMode = "Distance", maxDistance = 500, shakeReduction = true,
        snapOnAcquire = false, snapStrength = 0.5, easing = "Smooth",
        highlightTarget = true, targetLockIndicator = true
    }
    crosshairSettings[player.UserId] = { style = "Cross", size = 10, thickness = 2, gap = 4, color = Colors.AccentBright, outline = true }
    bunnyHopEnabled[player.UserId] = false
    fullbrightEnabled[player.UserId] = false
    noFogEnabled[player.UserId] = false
    crosshairEnabled[player.UserId] = false
    fovCircleEnabled[player.UserId] = true
    trackingMode[player.UserId] = "hold"
    toggleTrackingActive[player.UserId] = false
    invisEnabled[player.UserId] = false
    godModeEnabled[player.UserId] = false
    walkflingEnabled[player.UserId] = false
    walkableEnabled[player.UserId] = false
    sitflingEnabled[player.UserId] = false
    
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "AdminPanel"
    screenGui.ResetOnSpawn = false
    screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    screenGui.IgnoreGuiInset = true
    screenGui.Parent = player:WaitForChild("PlayerGui")
    table.insert(guiInstances, screenGui)
    
    -- FOV Circle
    local fovCircle = Instance.new("Frame")
    fovCircle.Name = "FOVCircle"
    fovCircle.Size = UDim2.new(0, 300, 0, 300)
    fovCircle.Position = UDim2.new(0.5, 0, 0.5, 0)
    fovCircle.AnchorPoint = Vector2.new(0.5, 0.5)
    fovCircle.BackgroundTransparency = 1
    fovCircle.Visible = false
    fovCircle.Parent = screenGui
    local fovCircleCorner = Instance.new("UICorner")
    fovCircleCorner.CornerRadius = UDim.new(1, 0)
    fovCircleCorner.Parent = fovCircle
    local fovStroke = Instance.new("UIStroke")
    fovStroke.Color = Colors.AccentBright
    fovStroke.Thickness = 1
    fovStroke.Transparency = 0.5
    fovStroke.Parent = fovCircle
    
    local function updateFOVCircle()
        local settings = aimlockSettings[player.UserId]
        local radius = settings.fovRadius or 150
        fovCircle.Size = UDim2.new(0, radius * 2, 0, radius * 2)
        fovCircle.Visible = settings.showFOVCircle and fovCircleEnabled[player.UserId]
    end
    
    -- Custom Crosshair
    local crosshairFrame = Instance.new("Frame")
    crosshairFrame.Name = "CustomCrosshair"
    crosshairFrame.Size = UDim2.new(0, 0, 0, 0)
    crosshairFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    crosshairFrame.BackgroundTransparency = 1
    crosshairFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    crosshairFrame.Visible = false
    crosshairFrame.Parent = screenGui
    local crosshairLines, crosshairOutlines = {}, {}
    for i = 1, 4 do
        local outline = Instance.new("Frame")
        outline.Name = "Outline" .. i
        outline.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        outline.BorderSizePixel = 0
        outline.AnchorPoint = Vector2.new(0.5, 0.5)
        outline.Parent = crosshairFrame
        table.insert(crosshairOutlines, outline)
        local line = Instance.new("Frame")
        line.Name = "Line" .. i
        line.BackgroundColor3 = Colors.AccentBright
        line.BorderSizePixel = 0
        line.AnchorPoint = Vector2.new(0.5, 0.5)
        line.Parent = crosshairFrame
        table.insert(crosshairLines, line)
    end
    local centerDot = Instance.new("Frame")
    centerDot.Name = "CenterDot"
    centerDot.BackgroundColor3 = Colors.AccentBright
    centerDot.BorderSizePixel = 0
    centerDot.AnchorPoint = Vector2.new(0.5, 0.5)
    centerDot.Position = UDim2.new(0.5, 0, 0.5, 0)
    centerDot.Visible = false
    centerDot.Parent = crosshairFrame
    local dotCorner = Instance.new("UICorner")
    dotCorner.CornerRadius = UDim.new(1, 0)
    dotCorner.Parent = centerDot
    
    local function updateCrosshair()
        local settings = crosshairSettings[player.UserId]
        local style, size, thickness, gap = settings.style, settings.size, settings.thickness, settings.gap
        local color, showOutline = settings.color, settings.outline
        for _, line in ipairs(crosshairLines) do line.Visible = false end
        for _, outline in ipairs(crosshairOutlines) do outline.Visible = false end
        centerDot.Visible = false
        if style == "Cross" or style == "Cross + Dot" then
            crosshairLines[1].Size = UDim2.new(0, thickness, 0, size)
            crosshairLines[1].Position = UDim2.new(0.5, 0, 0.5, -(gap + size/2))
            crosshairLines[1].BackgroundColor3 = color
            crosshairLines[1].Visible = true
            crosshairLines[2].Size = UDim2.new(0, thickness, 0, size)
            crosshairLines[2].Position = UDim2.new(0.5, 0, 0.5, gap + size/2)
            crosshairLines[2].BackgroundColor3 = color
            crosshairLines[2].Visible = true
            crosshairLines[3].Size = UDim2.new(0, size, 0, thickness)
            crosshairLines[3].Position = UDim2.new(0.5, -(gap + size/2), 0.5, 0)
            crosshairLines[3].BackgroundColor3 = color
            crosshairLines[3].Visible = true
            crosshairLines[4].Size = UDim2.new(0, size, 0, thickness)
            crosshairLines[4].Position = UDim2.new(0.5, gap + size/2, 0.5, 0)
            crosshairLines[4].BackgroundColor3 = color
            crosshairLines[4].Visible = true
            if showOutline then
                for i = 1, 4 do
                    crosshairOutlines[i].Size = UDim2.new(0, crosshairLines[i].Size.X.Offset + 2, 0, crosshairLines[i].Size.Y.Offset + 2)
                    crosshairOutlines[i].Position = crosshairLines[i].Position
                    crosshairOutlines[i].Visible = true
                end
            end
            if style == "Cross + Dot" then
                centerDot.Size = UDim2.new(0, thickness + 2, 0, thickness + 2)
                centerDot.BackgroundColor3 = color
                centerDot.Visible = true
            end
        elseif style == "Dot" then
            centerDot.Size = UDim2.new(0, size, 0, size)
            centerDot.BackgroundColor3 = color
            centerDot.Visible = true
        elseif style == "Circle" then
            centerDot.Size = UDim2.new(0, size * 2, 0, size * 2)
            centerDot.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
            centerDot.BackgroundTransparency = 0.8
            centerDot.Visible = true
            local circleStroke = centerDot:FindFirstChild("CircleStroke") or Instance.new("UIStroke")
            circleStroke.Name = "CircleStroke"
            circleStroke.Color = color
            circleStroke.Thickness = thickness
            circleStroke.Parent = centerDot
        elseif style == "T-Shape" then
            crosshairLines[1].Size = UDim2.new(0, thickness, 0, size)
            crosshairLines[1].Position = UDim2.new(0.5, 0, 0.5, -(gap + size/2))
            crosshairLines[1].BackgroundColor3 = color
            crosshairLines[1].Visible = true
            crosshairLines[3].Size = UDim2.new(0, size, 0, thickness)
            crosshairLines[3].Position = UDim2.new(0.5, -(gap + size/2), 0.5, 0)
            crosshairLines[3].BackgroundColor3 = color
            crosshairLines[3].Visible = true
            crosshairLines[4].Size = UDim2.new(0, size, 0, thickness)
            crosshairLines[4].Position = UDim2.new(0.5, gap + size/2, 0.5, 0)
            crosshairLines[4].BackgroundColor3 = color
            crosshairLines[4].Visible = true
        end
    end
    
    -- Main Frame
    local mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainFrame"
    mainFrame.Size = UDim2.new(0, 650, 0, 550)
    mainFrame.Position = UDim2.new(0.5, -325, 0.5, -275)
    mainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
    mainFrame.BorderSizePixel = 0
    mainFrame.Visible = true
    mainFrame.Active = true
    mainFrame.Draggable = true
    mainFrame.Parent = screenGui
    local mainCorner = Instance.new("UICorner")
    mainCorner.CornerRadius = UDim.new(0, 10)
    mainCorner.Parent = mainFrame
    local mainStroke = Instance.new("UIStroke")
    mainStroke.Color = Color3.fromRGB(60, 60, 80)
    mainStroke.Thickness = 1
    mainStroke.Parent = mainFrame
    
    -- Title Bar
    local titleBar = Instance.new("Frame")
    titleBar.Size = UDim2.new(1, 0, 0, 45)
    titleBar.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    titleBar.BorderSizePixel = 0
    titleBar.Parent = mainFrame
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 10)
    titleCorner.Parent = titleBar
    local titleGradient = Instance.new("UIGradient")
    titleGradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 30, 60)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 30))
    }
    titleGradient.Rotation = 90
    titleGradient.Parent = titleBar
    
    -- Logo
    local logoFrame = Instance.new("Frame")
    logoFrame.Size = UDim2.new(0, 35, 0, 35)
    logoFrame.Position = UDim2.new(0, 8, 0, 5)
    logoFrame.BackgroundColor3 = Color3.fromRGB(130, 80, 200)
    logoFrame.BorderSizePixel = 0
    logoFrame.Parent = titleBar
    local logoCorner = Instance.new("UICorner")
    logoCorner.CornerRadius = UDim.new(0, 8)
    logoCorner.Parent = logoFrame
    local logoText = Instance.new("TextLabel")
    logoText.Size = UDim2.new(1, 0, 1, 0)
    logoText.BackgroundTransparency = 1
    logoText.Text = "B"
    logoText.TextColor3 = Color3.fromRGB(255, 255, 255)
    logoText.TextSize = 20
    logoText.Font = Enum.Font.GothamBold
    logoText.Parent = logoFrame
    
    local titleText = Instance.new("TextLabel")
    titleText.Size = UDim2.new(0, 200, 1, 0)
    titleText.Position = UDim2.new(0, 50, 0, 0)
    titleText.BackgroundTransparency = 1
    titleText.Text = "Binxix Hub"
    titleText.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleText.TextSize = 18
    titleText.Font = Enum.Font.GothamBold
    titleText.TextXAlignment = Enum.TextXAlignment.Left
    titleText.Parent = titleBar
    
    local versionText = Instance.new("TextLabel")
    versionText.Size = UDim2.new(0, 100, 0, 14)
    versionText.Position = UDim2.new(0, 50, 0, 26)
    versionText.BackgroundTransparency = 1
    versionText.Text = "v5.0"
    versionText.TextColor3 = Color3.fromRGB(130, 130, 150)
    versionText.TextSize = 10
    versionText.Font = Enum.Font.Gotham
    versionText.TextXAlignment = Enum.TextXAlignment.Left
    versionText.Parent = titleBar
    
    -- UNLOAD BUTTON
    local unloadBtn = Instance.new("TextButton")
    unloadBtn.Size = UDim2.new(0, 70, 0, 28)
    unloadBtn.Position = UDim2.new(1, -120, 0, 8)
    unloadBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    unloadBtn.BackgroundTransparency = 0.2
    unloadBtn.Text = "Unload"
    unloadBtn.TextColor3 = Colors.Text
    unloadBtn.TextSize = 11
    unloadBtn.Font = Enum.Font.GothamBold
    unloadBtn.Parent = titleBar
    local unloadBtnCorner = Instance.new("UICorner")
    unloadBtnCorner.CornerRadius = UDim.new(0, 6)
    unloadBtnCorner.Parent = unloadBtn
    unloadBtn.MouseEnter:Connect(function() unloadBtn.BackgroundTransparency = 0 end)
    unloadBtn.MouseLeave:Connect(function() unloadBtn.BackgroundTransparency = 0.2 end)
    unloadBtn.MouseButton1Click:Connect(function() unloadScript(player) end)
    
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 35, 0, 35)
    closeBtn.Position = UDim2.new(1, -42, 0, 5)
    closeBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    closeBtn.BackgroundTransparency = 0.5
    closeBtn.Text = "ðŸ‘Œ"
    closeBtn.TextColor3 = Colors.Text
    closeBtn.TextSize = 22
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.Parent = titleBar
    local closeBtnCorner = Instance.new("UICorner")
    closeBtnCorner.CornerRadius = UDim.new(0, 8)
    closeBtnCorner.Parent = closeBtn
    closeBtn.MouseEnter:Connect(function() closeBtn.BackgroundTransparency = 0.2 end)
    closeBtn.MouseLeave:Connect(function() closeBtn.BackgroundTransparency = 0.5 end)
    closeBtn.MouseButton1Click:Connect(function() mainFrame.Visible = false end)
    
    -- Sidebar for tabs
    local sidebar = Instance.new("Frame")
    sidebar.Size = UDim2.new(0, 160, 1, -65)
    sidebar.Position = UDim2.new(0, 10, 0, 52)
    sidebar.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
    sidebar.BorderSizePixel = 0
    sidebar.Parent = mainFrame
    local sidebarCorner = Instance.new("UICorner")
    sidebarCorner.CornerRadius = UDim.new(0, 8)
    sidebarCorner.Parent = sidebar
    
    -- Updated tabs with Other Scripts
    local tabs = {"Tracking", "ESP", "Visuals", "Movement", "Other Scripts", "Combat"}
    local tabIcons = {"", "", "", "", "", ""}
    local tabButtons = {}
    
    for i, tabName in ipairs(tabs) do
        local tabBtn = Instance.new("TextButton")
        tabBtn.Name = tabName .. "Tab"
        tabBtn.Size = UDim2.new(1, -16, 0, 42)
        tabBtn.Position = UDim2.new(0, 8, 0, (i-1) * 48 + 8)
        tabBtn.BackgroundColor3 = i == 1 and Color3.fromRGB(130, 80, 200) or Color3.fromRGB(25, 25, 35)
        tabBtn.BackgroundTransparency = i == 1 and 0 or 0.3
        tabBtn.BorderSizePixel = 0
        tabBtn.Text = "  " .. tabIcons[i] .. "  " .. tabName
        tabBtn.TextColor3 = i == 1 and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(150, 150, 170)
        tabBtn.TextSize = 13
        tabBtn.Font = i == 1 and Enum.Font.GothamBold or Enum.Font.Gotham
        tabBtn.TextXAlignment = Enum.TextXAlignment.Left
        tabBtn.Parent = sidebar
        local tabCorner = Instance.new("UICorner")
        tabCorner.CornerRadius = UDim.new(0, 8)
        tabCorner.Parent = tabBtn
        
        if i == 1 then
            local tabGlow = Instance.new("UIStroke")
            tabGlow.Name = "ActiveGlow"
            tabGlow.Color = Color3.fromRGB(160, 100, 255)
            tabGlow.Thickness = 1
            tabGlow.Transparency = 0.5
            tabGlow.Parent = tabBtn
        end
        
        tabButtons[tabName] = tabBtn
    end
    
    local contentArea = Instance.new("ScrollingFrame")
    contentArea.Size = UDim2.new(1, -190, 1, -85)
    contentArea.Position = UDim2.new(0, 178, 0, 52)
    contentArea.BackgroundTransparency = 1
    contentArea.BorderSizePixel = 0
    contentArea.ScrollBarThickness = 6
    contentArea.ScrollBarImageColor3 = Color3.fromRGB(130, 80, 200)
    contentArea.CanvasSize = UDim2.new(0, 0, 0, 0)
    contentArea.Parent = mainFrame
    
    local statusBar = Instance.new("Frame")
    statusBar.Size = UDim2.new(1, -20, 0, 25)
    statusBar.Position = UDim2.new(0, 10, 1, -30)
    statusBar.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
    statusBar.BorderSizePixel = 0
    statusBar.Parent = mainFrame
    local statusCorner = Instance.new("UICorner")
    statusCorner.CornerRadius = UDim.new(0, 6)
    statusCorner.Parent = statusBar
    
    local statusLabel = Instance.new("TextLabel")
    statusLabel.Size = UDim2.new(1, -16, 1, 0)
    statusLabel.Position = UDim2.new(0, 8, 0, 0)
    statusLabel.BackgroundTransparency = 1
    statusLabel.Text = " Ready | RCtrl toggle | RMB track (auto-acquires)"
    statusLabel.TextColor3 = Color3.fromRGB(130, 80, 200)
    statusLabel.TextSize = 10
    statusLabel.Font = Enum.Font.Gotham
    statusLabel.TextXAlignment = Enum.TextXAlignment.Left
    statusLabel.Parent = statusBar
    
    -- Helper Functions (createSection, createCheckbox, createSlider, createDropdown, createKeybindButton)
    
    -- Helper Functions
    local function createSection(parent, title, posX, posY, width, height)
        local section = Instance.new("Frame")
        section.Size = UDim2.new(0, width, 0, height)
        section.Position = UDim2.new(0, posX, 0, posY)
        section.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
        section.BackgroundTransparency = 0
        section.BorderSizePixel = 0
        section.Parent = parent
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 8)
        corner.Parent = section
        local stroke = Instance.new("UIStroke")
        stroke.Color = Color3.fromRGB(50, 50, 70)
        stroke.Thickness = 1
        stroke.Transparency = 0.5
        stroke.Parent = section
        local titleLabel = Instance.new("TextLabel")
        titleLabel.Size = UDim2.new(1, 0, 0, 30)
        titleLabel.Position = UDim2.new(0, 0, 0, 0)
        titleLabel.BackgroundColor3 = Color3.fromRGB(30, 30, 42)
        titleLabel.BorderSizePixel = 0
        titleLabel.Text = title
        titleLabel.TextColor3 = Color3.fromRGB(160, 100, 255)
        titleLabel.TextSize = 12
        titleLabel.Font = Enum.Font.GothamBold
        titleLabel.TextXAlignment = Enum.TextXAlignment.Left
        titleLabel.Parent = section
        local titlePadding = Instance.new("UIPadding")
        titlePadding.PaddingLeft = UDim.new(0, 12)
        titlePadding.Parent = titleLabel
        local titleCorner = Instance.new("UICorner")
        titleCorner.CornerRadius = UDim.new(0, 8)
        titleCorner.Parent = titleLabel
        return section
    end
    
    local function createCheckbox(parent, text, posX, posY, default, callback)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(0, 200, 0, 20)
        container.Position = UDim2.new(0, posX, 0, posY)
        container.BackgroundTransparency = 1
        container.Parent = parent
        local checkbox = Instance.new("Frame")
        checkbox.Size = UDim2.new(0, 14, 0, 14)
        checkbox.Position = UDim2.new(0, 0, 0, 3)
        checkbox.BackgroundColor3 = default and Colors.Accent or Colors.BackgroundLight
        checkbox.BorderSizePixel = 0
        checkbox.Parent = container
        local checkCorner = Instance.new("UICorner")
        checkCorner.CornerRadius = UDim.new(0, 3)
        checkCorner.Parent = checkbox
        local checkMark = Instance.new("TextLabel")
        checkMark.Size = UDim2.new(1, 0, 1, 0)
        checkMark.BackgroundTransparency = 1
        checkMark.Text = default and "" or ""
        checkMark.TextColor3 = Colors.Text
        checkMark.TextSize = 11
        checkMark.Font = Enum.Font.GothamBold
        checkMark.Parent = checkbox
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(0, 180, 0, 20)
        label.Position = UDim2.new(0, 20, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.TextColor3 = Colors.Text
        label.TextSize = 10
        label.Font = Enum.Font.Gotham
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.TextWrapped = false
        label.Parent = container
        local isEnabled = default
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 1, 0)
        btn.BackgroundTransparency = 1
        btn.Text = ""
        btn.Parent = container
        btn.MouseButton1Click:Connect(function()
            if isUnloading or _G.BinxixUnloaded then return end
            isEnabled = not isEnabled
            checkbox.BackgroundColor3 = isEnabled and Colors.Accent or Colors.BackgroundLight
            checkMark.Text = isEnabled and "" or ""
            if callback then callback(isEnabled) end
        end)
        return container
    end
    
    local function createSlider(parent, label, posX, posY, min, max, default, callback)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(0, 150, 0, 34)
        container.Position = UDim2.new(0, posX, 0, posY)
        container.BackgroundTransparency = 1
        container.Parent = parent
        local labelText = Instance.new("TextLabel")
        labelText.Size = UDim2.new(0.75, 0, 0, 14)
        labelText.BackgroundTransparency = 1
        labelText.Text = label
        labelText.TextColor3 = Colors.TextDim
        labelText.TextSize = 10
        labelText.Font = Enum.Font.Gotham
        labelText.TextXAlignment = Enum.TextXAlignment.Left
        labelText.Parent = container
        local valueLabel = Instance.new("TextLabel")
        valueLabel.Size = UDim2.new(0.25, 0, 0, 14)
        valueLabel.Position = UDim2.new(0.75, 0, 0, 0)
        valueLabel.BackgroundTransparency = 1
        valueLabel.Text = tostring(default)
        valueLabel.TextColor3 = Colors.AccentBright
        valueLabel.TextSize = 10
        valueLabel.Font = Enum.Font.GothamBold
        valueLabel.TextXAlignment = Enum.TextXAlignment.Right
        valueLabel.Parent = container
        local sliderBg = Instance.new("Frame")
        sliderBg.Size = UDim2.new(1, 0, 0, 6)
        sliderBg.Position = UDim2.new(0, 0, 0, 20)
        sliderBg.BackgroundColor3 = Colors.BackgroundLight
        sliderBg.BorderSizePixel = 0
        sliderBg.Parent = container
        local sliderCorner = Instance.new("UICorner")
        sliderCorner.CornerRadius = UDim.new(0, 3)
        sliderCorner.Parent = sliderBg
        local sliderFill = Instance.new("Frame")
        sliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
        sliderFill.BackgroundColor3 = Colors.Accent
        sliderFill.BorderSizePixel = 0
        sliderFill.Parent = sliderBg
        local fillCorner = Instance.new("UICorner")
        fillCorner.CornerRadius = UDim.new(0, 3)
        fillCorner.Parent = sliderFill
        local currentValue = default
        local dragging = false
        local sliderBtn = Instance.new("TextButton")
        sliderBtn.Size = UDim2.new(1, 0, 1, 12)
        sliderBtn.Position = UDim2.new(0, 0, 0, -6)
        sliderBtn.BackgroundTransparency = 1
        sliderBtn.Text = ""
        sliderBtn.Parent = sliderBg
        sliderBtn.MouseButton1Down:Connect(function() dragging = true end)
        local inputEndedConn = UserInputService.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
        end)
        table.insert(allConnections, inputEndedConn)
        local sliderUpdateConn = RunService.RenderStepped:Connect(function()
            if isUnloading or _G.BinxixUnloaded then return end
            if dragging then
                local mouse = player:GetMouse()
                local relativeX = math.clamp((mouse.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
                currentValue = math.floor(min + relativeX * (max - min) + 0.5)
                if max <= 1 then currentValue = math.floor((min + relativeX * (max - min)) * 100) / 100 end
                sliderFill.Size = UDim2.new(relativeX, 0, 1, 0)
                valueLabel.Text = tostring(currentValue)
                if callback then callback(currentValue) end
            end
        end)
        table.insert(allConnections, sliderUpdateConn)
        return container
    end
    
    local openDropdowns = {}
    local function createDropdown(parent, label, posX, posY, options, default, callback)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(0, 200, 0, 42)
        container.Position = UDim2.new(0, posX, 0, posY)
        container.BackgroundTransparency = 1
        container.Parent = parent
        local labelText = Instance.new("TextLabel")
        labelText.Size = UDim2.new(1, 0, 0, 14)
        labelText.BackgroundTransparency = 1
        labelText.Text = label
        labelText.TextColor3 = Colors.TextDim
        labelText.TextSize = 10
        labelText.Font = Enum.Font.Gotham
        labelText.TextXAlignment = Enum.TextXAlignment.Left
        labelText.Parent = container
        local dropBtn = Instance.new("TextButton")
        dropBtn.Size = UDim2.new(1, 0, 0, 24)
        dropBtn.Position = UDim2.new(0, 0, 0, 16)
        dropBtn.BackgroundColor3 = Colors.BackgroundLight
        dropBtn.BorderSizePixel = 0
        dropBtn.Text = "  " .. default
        dropBtn.TextColor3 = Colors.Text
        dropBtn.TextSize = 10
        dropBtn.Font = Enum.Font.Gotham
        dropBtn.TextXAlignment = Enum.TextXAlignment.Left
        dropBtn.Parent = container
        local dropCorner = Instance.new("UICorner")
        dropCorner.CornerRadius = UDim.new(0, 3)
        dropCorner.Parent = dropBtn
        local arrow = Instance.new("TextLabel")
        arrow.Size = UDim2.new(0, 16, 1, 0)
        arrow.Position = UDim2.new(1, -18, 0, 0)
        arrow.BackgroundTransparency = 1
        arrow.Text = ""
        arrow.TextColor3 = Colors.Accent
        arrow.TextSize = 10
        arrow.Font = Enum.Font.GothamBold
        arrow.Parent = dropBtn
        local currentSelection = default
        local isOpen = false
        local optionsFrame = Instance.new("Frame")
        optionsFrame.Name = "DropdownOptions"
        optionsFrame.Size = UDim2.new(0, 200, 0, #options * 24)
        optionsFrame.BackgroundColor3 = Colors.Background
        optionsFrame.BorderSizePixel = 0
        optionsFrame.Visible = false
        optionsFrame.ZIndex = 999
        optionsFrame.Parent = screenGui
        local optCorner = Instance.new("UICorner")
        optCorner.CornerRadius = UDim.new(0, 3)
        optCorner.Parent = optionsFrame
        local optStroke = Instance.new("UIStroke")
        optStroke.Color = Colors.Accent
        optStroke.Thickness = 1
        optStroke.Parent = optionsFrame
        for i, opt in ipairs(options) do
            local optBtn = Instance.new("TextButton")
            optBtn.Size = UDim2.new(1, 0, 0, 24)
            optBtn.Position = UDim2.new(0, 0, 0, (i-1) * 24)
            optBtn.BackgroundColor3 = Colors.BackgroundLight
            optBtn.BackgroundTransparency = 0.5
            optBtn.Text = "  " .. opt
            optBtn.TextColor3 = Colors.Text
            optBtn.TextSize = 10
            optBtn.Font = Enum.Font.Gotham
            optBtn.TextXAlignment = Enum.TextXAlignment.Left
            optBtn.ZIndex = 1000
            optBtn.Parent = optionsFrame
            optBtn.MouseEnter:Connect(function() optBtn.BackgroundTransparency = 0; optBtn.BackgroundColor3 = Colors.Accent end)
            optBtn.MouseLeave:Connect(function() optBtn.BackgroundTransparency = 0.5; optBtn.BackgroundColor3 = Colors.BackgroundLight end)
            optBtn.MouseButton1Click:Connect(function()
                if isUnloading or _G.BinxixUnloaded then return end
                currentSelection = opt
                dropBtn.Text = "  " .. opt
                isOpen = false
                optionsFrame.Visible = false
                arrow.Text = ""
                if callback then callback(opt) end
            end)
        end
        local function updateOptionsPosition()
            local absPos = dropBtn.AbsolutePosition
            local absSize = dropBtn.AbsoluteSize
            optionsFrame.Position = UDim2.new(0, absPos.X, 0, absPos.Y + absSize.Y + 2)
        end
        local function closeDropdown()
            isOpen = false
            optionsFrame.Visible = false
            arrow.Text = ""
        end
        dropBtn.MouseButton1Click:Connect(function()
            if isUnloading or _G.BinxixUnloaded then return end
            for _, closeFunc in pairs(openDropdowns) do
                if closeFunc ~= closeDropdown then closeFunc() end
            end
            isOpen = not isOpen
            if isOpen then updateOptionsPosition() end
            optionsFrame.Visible = isOpen
            arrow.Text = isOpen and "" or ""
        end)
        table.insert(openDropdowns, closeDropdown)
        return container
    end
    
    local function createKeybindButton(parent, label, posX, posY, defaultKey, keybindId, callback)
        local container = Instance.new("Frame")
        container.Size = UDim2.new(0, 200, 0, 36)
        container.Position = UDim2.new(0, posX, 0, posY)
        container.BackgroundTransparency = 1
        container.Parent = parent
        local labelText = Instance.new("TextLabel")
        labelText.Size = UDim2.new(0, 100, 0, 14)
        labelText.BackgroundTransparency = 1
        labelText.Text = label
        labelText.TextColor3 = Colors.TextDim
        labelText.TextSize = 10
        labelText.Font = Enum.Font.Gotham
        labelText.TextXAlignment = Enum.TextXAlignment.Left
        labelText.Parent = container
        local keyBtn = Instance.new("TextButton")
        keyBtn.Size = UDim2.new(0, 90, 0, 22)
        keyBtn.Position = UDim2.new(0, 105, 0, 10)
        keyBtn.BackgroundColor3 = Colors.BackgroundLight
        keyBtn.BorderSizePixel = 0
        keyBtn.Text = defaultKey and defaultKey.Name or "None"
        keyBtn.TextColor3 = Colors.AccentBright
        keyBtn.TextSize = 10
        keyBtn.Font = Enum.Font.GothamBold
        keyBtn.Parent = container
        local keyCorner = Instance.new("UICorner")
        keyCorner.CornerRadius = UDim.new(0, 4)
        keyCorner.Parent = keyBtn
        local keyStroke = Instance.new("UIStroke")
        keyStroke.Color = Colors.Border
        keyStroke.Thickness = 1
        keyStroke.Parent = keyBtn
        keybinds[keybindId] = defaultKey
        keybindCallbacks[keybindId] = callback
        keyBtn.MouseButton1Click:Connect(function()
            if isUnloading or _G.BinxixUnloaded then return end
            keyBtn.Text = "..."
            keyBtn.TextColor3 = Colors.ESP_Close
            keyStroke.Color = Colors.ESP_Close
            waitingForKeybind[player.UserId] = { button = keyBtn, stroke = keyStroke, keybindId = keybindId }
        end)
        return container
    end
    
    local keybindInputConn = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if isUnloading or _G.BinxixUnloaded then return end
        local waiting = waitingForKeybind[player.UserId]
        if waiting and input.UserInputType == Enum.UserInputType.Keyboard then
            local keyCode = input.KeyCode
            keybinds[waiting.keybindId] = keyCode
            waiting.button.Text = keyCode.Name
            waiting.button.TextColor3 = Colors.AccentBright
            waiting.stroke.Color = Colors.Border
            waitingForKeybind[player.UserId] = nil
            statusLabel.Text = " Keybind set: " .. keyCode.Name
            return
        end
        if gameProcessed then return end
        if input.UserInputType == Enum.UserInputType.Keyboard then
            for keybindId, keyCode in pairs(keybinds) do
                if keyCode and input.KeyCode == keyCode then
                    local callback = keybindCallbacks[keybindId]
                    if callback then callback() end
                end
            end
        end
    end)
    table.insert(allConnections, keybindInputConn)
    
    local tabPages = {}

    -- AIMLOCK SYSTEM (tracking continues)
    local currentTarget = nil
    local lastTargetSwitch = 0
    local lastAimPosition = nil
    local targetHighlight = nil
    
    local lockIndicatorFrame = Instance.new("Frame")
    lockIndicatorFrame.Name = "LockIndicator"
    lockIndicatorFrame.Size = UDim2.new(0, 20, 0, 20)
    lockIndicatorFrame.BackgroundTransparency = 1
    lockIndicatorFrame.Visible = false
    lockIndicatorFrame.Parent = screenGui
    local lockIndicatorLines = {}
    for i = 1, 4 do
        local line = Instance.new("Frame")
        line.BackgroundColor3 = Colors.AccentBright
        line.BorderSizePixel = 0
        line.Parent = lockIndicatorFrame
        table.insert(lockIndicatorLines, line)
    end
    lockIndicatorLines[1].Size = UDim2.new(0, 8, 0, 2)
    lockIndicatorLines[1].Position = UDim2.new(0, 0, 0, 0)
    lockIndicatorLines[2].Size = UDim2.new(0, 2, 0, 8)
    lockIndicatorLines[2].Position = UDim2.new(0, 0, 0, 0)
    lockIndicatorLines[3].Size = UDim2.new(0, 8, 0, 2)
    lockIndicatorLines[3].Position = UDim2.new(1, -8, 1, -2)
    lockIndicatorLines[4].Size = UDim2.new(0, 2, 0, 8)
    lockIndicatorLines[4].Position = UDim2.new(1, -2, 1, -8)
    
    local function createTargetHighlight()
        if targetHighlight then targetHighlight:Destroy() end
        targetHighlight = Instance.new("Highlight")
        targetHighlight.Name = "AimlockHighlight"
        targetHighlight.FillColor = Colors.AccentBright
        targetHighlight.FillTransparency = 0.8
        targetHighlight.OutlineColor = Colors.AccentBright
        targetHighlight.OutlineTransparency = 0.3
        targetHighlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        return targetHighlight
    end
    
    local function easeOutQuad(t) return 1 - (1 - t) * (1 - t) end
    
    local function getTargetScore(admin, target, settings)
        local camera = Workspace.CurrentCamera
        if not camera then return math.huge end
        local targetChar = target.Character
        if not targetChar then return math.huge end
        local adminChar = admin.Character
        if not adminChar then return math.huge end
        local adminHRP = adminChar:FindFirstChild("HumanoidRootPart")
        local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
        local targetHumanoid = targetChar:FindFirstChild("Humanoid")
        if not adminHRP or not targetHRP then return math.huge end
        if targetHumanoid and targetHumanoid.Health <= 0 then return math.huge end
        local worldDistance = (adminHRP.Position - targetHRP.Position).Magnitude
        if worldDistance > (settings.maxDistance or 500) then return math.huge end
        local aimPart = targetChar:FindFirstChild(settings.aimPart) or targetChar:FindFirstChild("Head") or targetHRP
        local screenPos, onScreen = camera:WorldToViewportPoint(aimPart.Position)
        if not onScreen or screenPos.Z < 0 then return math.huge end
        local screenCenter = camera.ViewportSize / 2
        local crosshairDistance = (Vector2.new(screenPos.X, screenPos.Y) - screenCenter).Magnitude
        if crosshairDistance > (settings.fovRadius or 150) then return math.huge end
        if settings.requireLOS and not hasLineOfSight(admin, target) then return math.huge end
        local priorityMode = settings.priorityMode or "Distance"
        if priorityMode == "Distance" then return worldDistance
        elseif priorityMode == "Health" then return targetHumanoid and targetHumanoid.Health or 100
        elseif priorityMode == "Crosshair" then return crosshairDistance
        elseif priorityMode == "Threat" then
            local health = targetHumanoid and targetHumanoid.Health or 100
            local healthFactor = health / 100
            local distanceFactor = worldDistance / 100
            local targetLook = targetHRP.CFrame.LookVector
            local toAdmin = (adminHRP.Position - targetHRP.Position).Unit
            local facingFactor = math.max(0, targetLook:Dot(toAdmin))
            return (distanceFactor * 0.3) + (healthFactor * 0.3) - (facingFactor * 0.4)
        end
        return worldDistance
    end
    
    local function findBestTarget(admin, settings)
        local bestTarget, bestScore = nil, math.huge
        for _, target in ipairs(Players:GetPlayers()) do
            if isValidTarget(admin, target) then
                local score = getTargetScore(admin, target, settings)
                if score < bestScore then bestScore = score; bestTarget = target end
            end
        end
        return bestTarget, bestScore
    end
    
    local function getSmoothedAim(currentCF, targetCF, settings)
        local easing = settings.easing or "Smooth"
        local smoothness = settings.smoothness or 0.15
        local lerpFactor = smoothness
        if easing == "Smooth" then lerpFactor = easeOutQuad(smoothness)
        elseif easing == "Snap" then lerpFactor = smoothness * 2; if lerpFactor > 0.8 then lerpFactor = 1 end end
        if settings.shakeReduction and lastAimPosition then
            local movement = (targetCF.Position - lastAimPosition).Magnitude
            if movement < 0.5 then lerpFactor = lerpFactor * 0.5 end
        end
        return currentCF:Lerp(targetCF, lerpFactor)
    end
    
    local function getPredictedPosition(targetChar, settings)
        local aimPartName = settings.aimPart or "Head"
        local aimPart = targetChar:FindFirstChild(aimPartName) or targetChar:FindFirstChild("Head") or targetChar:FindFirstChild("HumanoidRootPart")
        if not aimPart then return nil end
        local position = aimPart.Position
        if settings.prediction then
            local hrp = targetChar:FindFirstChild("HumanoidRootPart")
            if hrp then position = position + (hrp.AssemblyLinearVelocity * (settings.predictionAmount or 0.12)) end
        end
        return position
    end
    
    -- RMB Tracking
    local function startRMBTracking()
        stopRightMouseTracking(player)
        local settings = aimlockSettings[player.UserId]
        local lastNoTargetNotify = 0
        local bestTarget, score = findBestTarget(player, settings)
        if bestTarget then
            currentTarget = bestTarget
            lastTargetSwitch = tick()
            statusLabel.Text = " LOCKED: " .. bestTarget.Name
            if settings.highlightTarget then
                local highlight = createTargetHighlight()
                if bestTarget.Character then highlight.Parent = bestTarget.Character end
            end
            if settings.snapOnAcquire then
                local camera = Workspace.CurrentCamera
                local targetPos = getPredictedPosition(bestTarget.Character, settings)
                if targetPos and camera then camera.CFrame = camera.CFrame:Lerp(CFrame.new(camera.CFrame.Position, targetPos), settings.snapStrength or 0.5) end
            end
        else
            currentTarget = nil
            statusLabel.Text = " Scanning for targets..."
        end
        
        local connection = RunService.RenderStepped:Connect(function()
            if isUnloading or _G.BinxixUnloaded then return end
            local settings = aimlockSettings[player.UserId]
            local camera = Workspace.CurrentCamera
            if not camera then return end
            local bestTarget, bestScore = findBestTarget(player, settings)
            
            if not currentTarget or not currentTarget.Character then
                if bestTarget then
                    currentTarget = bestTarget
                    lastTargetSwitch = tick()
                    statusLabel.Text = " LOCKED: " .. bestTarget.Name
                    if settings.highlightTarget then
                        if targetHighlight then targetHighlight:Destroy() end
                        local highlight = createTargetHighlight()
                        if bestTarget.Character then highlight.Parent = bestTarget.Character end
                    end
                    if settings.snapOnAcquire then
                        local targetPos = getPredictedPosition(bestTarget.Character, settings)
                        if targetPos then camera.CFrame = camera.CFrame:Lerp(CFrame.new(camera.CFrame.Position, targetPos), settings.snapStrength or 0.5) end
                    end
                else
                    if tick() - lastNoTargetNotify > 1 then statusLabel.Text = " Scanning for targets..."; lastNoTargetNotify = tick() end
                    lockIndicatorFrame.Visible = false
                    return
                end
            end
            
            local currentScore = currentTarget and getTargetScore(player, currentTarget, settings) or math.huge
            local shouldSwitch = currentScore == math.huge
            
            if not shouldSwitch and tick() - lastTargetSwitch > (settings.targetSwitchDelay or 0.2) then
                if settings.stickyAim then
                    if bestTarget and bestTarget ~= currentTarget and bestScore < currentScore * (settings.stickyStrength or 0.8) then shouldSwitch = true end
                elseif bestTarget and bestTarget ~= currentTarget and bestScore < currentScore then shouldSwitch = true end
            end
            
            if shouldSwitch then
                if bestTarget then
                    currentTarget = bestTarget
                    lastTargetSwitch = tick()
                    statusLabel.Text = " LOCKED: " .. bestTarget.Name
                    if settings.highlightTarget then
                        if targetHighlight then targetHighlight:Destroy() end
                        local highlight = createTargetHighlight()
                        if bestTarget.Character then highlight.Parent = bestTarget.Character end
                    end
                else
                    currentTarget = nil
                    if targetHighlight then targetHighlight:Destroy(); targetHighlight = nil end
                    lockIndicatorFrame.Visible = false
                    statusLabel.Text = " Scanning for targets..."
                    return
                end
            end
            
            if currentTarget and currentTarget.Character then
                local targetPos = getPredictedPosition(currentTarget.Character, settings)
                if targetPos then
                    camera.CFrame = getSmoothedAim(camera.CFrame, CFrame.new(camera.CFrame.Position, targetPos), settings)
                    lastAimPosition = targetPos
                    if settings.targetLockIndicator then
                        local screenPos, onScreen = camera:WorldToViewportPoint(targetPos)
                        lockIndicatorFrame.Position = UDim2.new(0, screenPos.X - 10, 0, screenPos.Y - 10)
                        lockIndicatorFrame.Visible = onScreen
                    end
                end
            end
        end)
        rightMouseTracking[player.UserId] = {connection = connection}
    end
    
    local function stopRMBTrackingUI()
        stopRightMouseTracking(player)
        currentTarget = nil
        lastAimPosition = nil
        if targetHighlight then targetHighlight:Destroy(); targetHighlight = nil end
        lockIndicatorFrame.Visible = false
        statusLabel.Text = " Ready | RCtrl toggle | RMB track"
    end


    -- ===== TRACKING TAB =====
    local trackingPage = Instance.new("Frame")
    trackingPage.Name = "TrackingPage"
    trackingPage.Size = UDim2.new(1, 0, 1, 0)
    trackingPage.BackgroundTransparency = 1
    trackingPage.Visible = true
    trackingPage.Parent = contentArea
    tabPages["Tracking"] = trackingPage
    
    local valuesSection = createSection(trackingPage, "Aim Settings", 0, 0, 220, 210)
    createCheckbox(valuesSection, "Toggle Mode", 8, 38, false, function(e) trackingMode[player.UserId] = e and "toggle" or "hold" end)
    createSlider(valuesSection, "Smoothness:", 8, 62, 0.05, 1, 0.15, function(v) aimlockSettings[player.UserId].smoothness = v end)
    createCheckbox(valuesSection, "Prediction", 8, 100, true, function(e) aimlockSettings[player.UserId].prediction = e end)
    createSlider(valuesSection, "Predict Amount:", 8, 122, 0.05, 0.3, 0.12, function(v) aimlockSettings[player.UserId].predictionAmount = v end)
    createCheckbox(valuesSection, "Require Line of Sight", 8, 160, true, function(e) aimlockSettings[player.UserId].requireLOS = e end)
    createCheckbox(valuesSection, "Sticky Aim", 8, 180, true, function(e) aimlockSettings[player.UserId].stickyAim = e end)
    
    local aimlockSection = createSection(trackingPage, "Aimlock FOV", 230, 0, 220, 210)
    createDropdown(aimlockSection, "Lock Part", 8, 38, {"Head", "HumanoidRootPart", "UpperTorso", "Torso", "LeftUpperArm", "RightUpperArm"}, "Head", function(v) aimlockSettings[player.UserId].aimPart = v end)
    createCheckbox(aimlockSection, "Show FOV Circle", 8, 84, true, function(e) aimlockSettings[player.UserId].showFOVCircle = e; fovCircleEnabled[player.UserId] = e; updateFOVCircle() end)
    createSlider(aimlockSection, "FOV Radius:", 8, 108, 50, 400, 150, function(v) aimlockSettings[player.UserId].fovRadius = v; updateFOVCircle() end)
    createSlider(aimlockSection, "Circle Opacity:", 8, 146, 0, 100, 50, function(v) aimlockSettings[player.UserId].fovOpacity = v / 100; fovStroke.Transparency = 1 - (v / 100) end)
    createSlider(aimlockSection, "Max Distance:", 8, 184, 100, 1000, 500, function(v) aimlockSettings[player.UserId].maxDistance = v end)
    
    local advancedSection = createSection(trackingPage, "Advanced", 0, 220, 220, 130)
    createDropdown(advancedSection, "Priority Mode", 8, 38, {"Distance", "Health", "Crosshair", "Threat"}, "Distance", function(v) aimlockSettings[player.UserId].priorityMode = v end)
    createDropdown(advancedSection, "Aim Easing", 8, 92, {"Smooth", "Linear", "Snap"}, "Smooth", function(v) aimlockSettings[player.UserId].easing = v end)
    
    local indicatorSection = createSection(trackingPage, "Indicators", 230, 220, 220, 150)
    createCheckbox(indicatorSection, "Highlight Target", 8, 38, true, function(e) aimlockSettings[player.UserId].highlightTarget = e end)
    createCheckbox(indicatorSection, "Lock Indicator", 8, 62, true, function(e) aimlockSettings[player.UserId].targetLockIndicator = e end)
    createCheckbox(indicatorSection, "Snap on Acquire", 8, 86, false, function(e) aimlockSettings[player.UserId].snapOnAcquire = e end)
    createSlider(indicatorSection, "Snap Strength:", 8, 108, 0.1, 1, 0.5, function(v) aimlockSettings[player.UserId].snapStrength = v end)
    
    contentArea.CanvasSize = UDim2.new(0, 0, 0, 380)
    
    -- ===== ESP TAB =====
    local espPage = Instance.new("Frame")
    espPage.Name = "ESPPage"
    espPage.Size = UDim2.new(1, 0, 1, 0)
    espPage.BackgroundTransparency = 1
    espPage.Visible = false
    espPage.Parent = contentArea
    tabPages["ESP"] = espPage
    
    if gameConfig.espEnabled then
        local espSection = createSection(espPage, "ESP Features", 0, 0, 220, 260)
        createCheckbox(espSection, "Enabled", 8, 38, false, function(e)
            if e then enableESP(player, screenGui); statusLabel.Text = " ESP Enabled"
            else clearAllESP(player); statusLabel.Text = " ESP Disabled" end
        end)
        createCheckbox(espSection, "Corner Box", 8, 64, true, function(e) espSettings[player.UserId].boxEnabled = e end)
        createCheckbox(espSection, "Skeleton", 8, 90, true, function(e) espSettings[player.UserId].skeletonEnabled = e end)
        createCheckbox(espSection, "Tracers", 8, 116, true, function(e) espSettings[player.UserId].tracerEnabled = e end)
        createCheckbox(espSection, "Names", 8, 142, true, function(e) espSettings[player.UserId].nameEnabled = e end)
        createCheckbox(espSection, "Health Bars", 8, 168, true, function(e) espSettings[player.UserId].healthEnabled = e end)
        createCheckbox(espSection, "Distance", 8, 194, true, function(e) espSettings[player.UserId].distanceEnabled = e end)
        createCheckbox(espSection, "Head Dot", 8, 220, true, function(e) espSettings[player.UserId].headDotEnabled = e end)
        
        local espAppearSection = createSection(espPage, "Appearance", 230, 0, 220, 200)
        createSlider(espAppearSection, "Tracer Width:", 8, 38, 1, 5, 1, function(v) espSettings[player.UserId].tracerThickness = v end)
        createSlider(espAppearSection, "Box Width:", 8, 76, 1, 5, 1, function(v) espSettings[player.UserId].boxThickness = v end)
        createSlider(espAppearSection, "Skeleton Width:", 8, 114, 1, 3, 1, function(v) espSettings[player.UserId].skeletonThickness = v end)
        createDropdown(espAppearSection, "Tracer Origin", 8, 152, {"Bottom", "Top", "Mouse"}, "Bottom", function(v) espSettings[player.UserId].tracerOrigin = v end)
        
        -- RADAR
        local radarEnabled = false
        local radarSize = 150
        local radarZoom = 1
        local radarFrame = Instance.new("Frame")
        radarFrame.Name = "Radar"
        radarFrame.Size = UDim2.new(0, radarSize, 0, radarSize)
        radarFrame.Position = UDim2.new(0, 10, 0, 10)
        radarFrame.BackgroundColor3 = Colors.Background
        radarFrame.BackgroundTransparency = 0.3
        radarFrame.BorderSizePixel = 0
        radarFrame.Visible = false
        radarFrame.Parent = screenGui
        Instance.new("UICorner", radarFrame).CornerRadius = UDim.new(1, 0)
        local radarStroke = Instance.new("UIStroke", radarFrame)
        radarStroke.Color = Colors.Accent
        radarStroke.Thickness = 2
        local radarCenter = Instance.new("Frame")
        radarCenter.Size = UDim2.new(0, 8, 0, 8)
        radarCenter.Position = UDim2.new(0.5, -4, 0.5, -4)
        radarCenter.BackgroundColor3 = Colors.AccentBright
        radarCenter.BorderSizePixel = 0
        radarCenter.Parent = radarFrame
        Instance.new("UICorner", radarCenter).CornerRadius = UDim.new(1, 0)
        local radarDots = {}
        
        local function updateRadar()
            if not radarEnabled then return end
            local myChar = player.Character
            if not myChar then return end
            local myHRP = myChar:FindFirstChild("HumanoidRootPart")
            if not myHRP then return end
            local myPos = myHRP.Position
            local myAngle = math.atan2(myHRP.CFrame.LookVector.X, myHRP.CFrame.LookVector.Z)
            for _, targetPlayer in ipairs(Players:GetPlayers()) do
                if targetPlayer ~= player and isValidTarget(player, targetPlayer) then
                    local targetChar = targetPlayer.Character
                    if targetChar then
                        local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
                        if targetHRP then
                            if not radarDots[targetPlayer.UserId] then
                                local dot = Instance.new("Frame")
                                dot.Size = UDim2.new(0, 6, 0, 6)
                                dot.BackgroundColor3 = Colors.ESP_Close
                                dot.BorderSizePixel = 0
                                dot.Parent = radarFrame
                                Instance.new("UICorner", dot).CornerRadius = UDim.new(1, 0)
                                radarDots[targetPlayer.UserId] = dot
                            end
                            local dot = radarDots[targetPlayer.UserId]
                            local relativePos = targetHRP.Position - myPos
                            local distance = relativePos.Magnitude
                            local rotatedX = relativePos.X * math.cos(-myAngle) - relativePos.Z * math.sin(-myAngle)
                            local rotatedZ = relativePos.X * math.sin(-myAngle) + relativePos.Z * math.cos(-myAngle)
                            local scale = radarSize / (200 * radarZoom)
                            local radarX, radarY = rotatedX * scale, -rotatedZ * scale
                            local maxDist = radarSize / 2 - 6
                            local dotDist = math.sqrt(radarX * radarX + radarY * radarY)
                            if dotDist > maxDist then local ratio = maxDist / dotDist; radarX = radarX * ratio; radarY = radarY * ratio end
                            dot.Position = UDim2.new(0.5, radarX - 3, 0.5, radarY - 3)
                            dot.BackgroundColor3 = getESPColor(distance)
                            dot.Visible = true
                        end
                    end
                else
                    if radarDots[targetPlayer.UserId] then radarDots[targetPlayer.UserId]:Destroy(); radarDots[targetPlayer.UserId] = nil end
                end
            end
        end
        
        local radarConn = RunService.RenderStepped:Connect(function()
            if isUnloading or _G.BinxixUnloaded then return end
            updateRadar()
        end)
        table.insert(allConnections, radarConn)
        
        local radarSection = createSection(espPage, "Radar", 0, 270, 220, 90)
        createCheckbox(radarSection, "Show Radar", 8, 38, false, function(e)
            radarEnabled = e
            radarFrame.Visible = e
            if not e then for id, dot in pairs(radarDots) do dot:Destroy() end; radarDots = {} end
        end)
        createSlider(radarSection, "Zoom:", 8, 64, 0.5, 3, 1, function(v) radarZoom = v end)
    else
        local messageLabel = Instance.new("TextLabel")
        messageLabel.Size = UDim2.new(1, -20, 0, 50)
        messageLabel.Position = UDim2.new(0, 10, 0, 10)
        messageLabel.BackgroundTransparency = 1
        messageLabel.Text = " ESP settings are no longer available in this game."
        messageLabel.TextColor3 = Color3.fromRGB(255, 80, 80)
        messageLabel.TextSize = 16
        messageLabel.Font = Enum.Font.GothamBold
        messageLabel.TextWrapped = true
        messageLabel.TextXAlignment = Enum.TextXAlignment.Center
        messageLabel.TextYAlignment = Enum.TextYAlignment.Center
        messageLabel.Parent = espPage
    end
    
    -- ===== VISUALS TAB =====
    local visualsPage = Instance.new("Frame")
    visualsPage.Name = "VisualsPage"
    visualsPage.Size = UDim2.new(1, 0, 1, 0)
    visualsPage.BackgroundTransparency = 1
    visualsPage.Visible = false
    visualsPage.Parent = contentArea
    tabPages["Visuals"] = visualsPage
    
    local fovSection = createSection(visualsPage, "Camera FOV", 0, 0, 230, 100)
    local fovEnabled, customFOV, fovConnection = false, 70, nil
    createCheckbox(fovSection, "Enabled", 8, 38, false, function(e)
        fovEnabled = e
        local camera = Workspace.CurrentCamera
        if e then
            if fovConnection then fovConnection:Disconnect() end
            fovConnection = RunService.RenderStepped:Connect(function() if isUnloading or _G.BinxixUnloaded then return end; if fovEnabled and camera then camera.FieldOfView = customFOV end end)
            table.insert(allConnections, fovConnection)
            statusLabel.Text = " FOV: " .. customFOV
        else
            if fovConnection then fovConnection:Disconnect(); fovConnection = nil end
            if camera then camera.FieldOfView = 70 end
            statusLabel.Text = " FOV reset"
        end
    end)
    createSlider(fovSection, "FOV Amount:", 8, 64, 30, 120, 70, function(v) customFOV = v; if fovEnabled then local c = Workspace.CurrentCamera; if c then c.FieldOfView = v end end end)
    
    local worldSection = createSection(visualsPage, "World Effects", 0, 110, 230, 100)
    createCheckbox(worldSection, "Fullbright", 8, 38, false, function(e) fullbrightEnabled[player.UserId] = e; if e then enableFullbright(player); statusLabel.Text = " Fullbright ON" else disableFullbright(player); statusLabel.Text = " Fullbright OFF" end end)
    createCheckbox(worldSection, "No Fog", 8, 64, false, function(e) noFogEnabled[player.UserId] = e; if e then enableNoFog(player); statusLabel.Text = " No Fog ON" else disableNoFog(player); statusLabel.Text = " No Fog OFF" end end)
    
    local crosshairSection = createSection(visualsPage, "Custom Crosshair", 245, 0, 230, 220)
    createCheckbox(crosshairSection, "Enabled", 8, 38, false, function(e) crosshairEnabled[player.UserId] = e; crosshairFrame.Visible = e; if e then updateCrosshair(); statusLabel.Text = " Crosshair ON" else statusLabel.Text = " Crosshair OFF" end end)
    createCheckbox(crosshairSection, "Outline", 8, 64, true, function(e) crosshairSettings[player.UserId].outline = e; if crosshairEnabled[player.UserId] then updateCrosshair() end end)
    createDropdown(crosshairSection, "Style", 8, 90, {"Cross", "Cross + Dot", "Dot", "Circle", "T-Shape"}, "Cross", function(v) crosshairSettings[player.UserId].style = v; if crosshairEnabled[player.UserId] then updateCrosshair() end end)
    createSlider(crosshairSection, "Size:", 8, 134, 5, 30, 10, function(v) crosshairSettings[player.UserId].size = v; if crosshairEnabled[player.UserId] then updateCrosshair() end end)
    createSlider(crosshairSection, "Thickness:", 8, 172, 1, 6, 2, function(v) crosshairSettings[player.UserId].thickness = v; if crosshairEnabled[player.UserId] then updateCrosshair() end end)
    
    -- ===== MOVEMENT TAB (SIMPLIFIED - NO FLY/NOCLIP) =====
    local movementPage = Instance.new("Frame")
    movementPage.Name = "MovementPage"
    movementPage.Size = UDim2.new(1, 0, 1, 0)
    movementPage.BackgroundTransparency = 1
    movementPage.Visible = false
    movementPage.Parent = contentArea
    tabPages["Movement"] = movementPage
    
    local charSection = createSection(movementPage, "Character", 0, 0, 230, 220)
    createCheckbox(charSection, "Speed Boost", 8, 38, false, function(e) local c = player.Character; if c then local h = c:FindFirstChild("Humanoid"); if h then h.WalkSpeed = e and 100 or 16 end end; statusLabel.Text = e and " Speed ON" or " Speed OFF" end)
    createCheckbox(charSection, "High Jump", 8, 64, false, function(e) local c = player.Character; if c then local h = c:FindFirstChild("Humanoid"); if h then h.JumpPower = e and 150 or 50 end end; statusLabel.Text = e and " Jump ON" or " Jump OFF" end)
    createCheckbox(charSection, "Bunny Hop", 8, 90, false, function(e) bunnyHopEnabled[player.UserId] = e; statusLabel.Text = e and " Bunny Hop ON" or " Bunny Hop OFF" end)
    createSlider(charSection, "Walk Speed:", 8, 116, 16, 200, 16, function(v) local c = player.Character; if c then local h = c:FindFirstChild("Humanoid"); if h then h.WalkSpeed = v end end end)
    createSlider(charSection, "Jump Power:", 8, 154, 50, 300, 50, function(v) local c = player.Character; if c then local h = c:FindFirstChild("Humanoid"); if h then h.JumpPower = v end end end)
    
    local serverSection = createSection(movementPage, "Server", 0, 230, 230, 150)
    local rejoinBtn = Instance.new("TextButton")
    rejoinBtn.Size = UDim2.new(0, 210, 0, 32)
    rejoinBtn.Position = UDim2.new(0, 8, 0, 38)
    rejoinBtn.BackgroundColor3 = Colors.Accent
    rejoinBtn.BackgroundTransparency = 0.3
    rejoinBtn.Text = " Rejoin Server"
    rejoinBtn.TextColor3 = Colors.Text
    rejoinBtn.TextSize = 11
    rejoinBtn.Font = Enum.Font.GothamBold
    rejoinBtn.Parent = serverSection
    Instance.new("UICorner", rejoinBtn).CornerRadius = UDim.new(0, 4)
    rejoinBtn.MouseButton1Click:Connect(function() statusLabel.Text = " Rejoining..."; pcall(function() TeleportService:TeleportToPlaceInstance(game.PlaceId, game.JobId, player) end) end)
    
    local serverHopBtn = Instance.new("TextButton")
    serverHopBtn.Size = UDim2.new(0, 210, 0, 32)
    serverHopBtn.Position = UDim2.new(0, 8, 0, 78)
    serverHopBtn.BackgroundColor3 = Colors.Accent
    serverHopBtn.BackgroundTransparency = 0.3
    serverHopBtn.Text = " Server Hop"
    serverHopBtn.TextColor3 = Colors.Text
    serverHopBtn.TextSize = 11
    serverHopBtn.Font = Enum.Font.GothamBold
    serverHopBtn.Parent = serverSection
    Instance.new("UICorner", serverHopBtn).CornerRadius = UDim.new(0, 4)
    serverHopBtn.MouseButton1Click:Connect(function() statusLabel.Text = " Hopping..."; pcall(function() TeleportService:Teleport(game.PlaceId, player) end) end)
    
    local randomBtn = Instance.new("TextButton")
    randomBtn.Size = UDim2.new(0, 210, 0, 32)
    randomBtn.Position = UDim2.new(0, 8, 0, 118)
    randomBtn.BackgroundColor3 = Colors.Accent
    randomBtn.BackgroundTransparency = 0.3
    randomBtn.Text = " Random Server"
    randomBtn.TextColor3 = Colors.Text
    randomBtn.TextSize = 11
    randomBtn.Font = Enum.Font.GothamBold
    randomBtn.Parent = serverSection
    Instance.new("UICorner", randomBtn).CornerRadius = UDim.new(0, 4)
    randomBtn.MouseButton1Click:Connect(function() statusLabel.Text = " Joining random..."; pcall(function() TeleportService:Teleport(game.PlaceId, player) end) end)
    
    local bunnyHopConn = RunService.RenderStepped:Connect(function()
        if isUnloading or _G.BinxixUnloaded then return end
        if bunnyHopEnabled[player.UserId] and UserInputService:IsKeyDown(Enum.KeyCode.Space) then
            local char = player.Character
            if char then local h = char:FindFirstChild("Humanoid"); if h and h:GetState() ~= Enum.HumanoidStateType.Jumping and h:GetState() ~= Enum.HumanoidStateType.Freefall then h:ChangeState(Enum.HumanoidStateType.Jumping) end end
        end
    end)
    table.insert(allConnections, bunnyHopConn)
    
    -- ===== OTHER SCRIPTS TAB =====
    local otherScriptsPage = Instance.new("Frame")
    otherScriptsPage.Name = "OtherScriptsPage"
    otherScriptsPage.Size = UDim2.new(1, 0, 1, 0)
    otherScriptsPage.BackgroundTransparency = 1
    otherScriptsPage.Visible = false
    otherScriptsPage.Parent = contentArea
    tabPages["Other Scripts"] = otherScriptsPage
    
    local scriptsSection = createSection(otherScriptsPage, "Popular Scripts", 0, 0, 460, 320)
    
    -- Helper function to create script buttons
    local function createScriptButton(parent, text, yPos, scriptUrl, closesGUI)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, -20, 0, 50)
        btn.Position = UDim2.new(0, 10, 0, yPos)
        btn.BackgroundColor3 = Colors.Accent
        btn.BackgroundTransparency = 0.3
        btn.Text = text
        btn.TextColor3 = Colors.Text
        btn.TextSize = 12
        btn.Font = Enum.Font.GothamBold
        btn.Parent = parent
        local btnCorner = Instance.new("UICorner")
        btnCorner.CornerRadius = UDim.new(0, 8)
        btnCorner.Parent = btn
        local btnStroke = Instance.new("UIStroke")
        btnStroke.Color = Colors.AccentBright
        btnStroke.Thickness = 1
        btnStroke.Transparency = 0.7
        btnStroke.Parent = btn
        
        btn.MouseEnter:Connect(function()
            btn.BackgroundTransparency = 0
            btnStroke.Transparency = 0.3
        end)
        btn.MouseLeave:Connect(function()
            btn.BackgroundTransparency = 0.3
            btnStroke.Transparency = 0.7
        end)
        
        btn.MouseButton1Click:Connect(function()
            btn.Text = " Loading..."
            btn.TextColor3 = Colors.AccentBright
            statusLabel.Text = " Loading " .. text .. "..."
            
            task.spawn(function()
                local success, err = pcall(function()
                    -- Use HttpGet to fetch and execute the script
                    local scriptContent = game:HttpGet(scriptUrl)
                    local loadFunc = loadstring(scriptContent)
                    if loadFunc then
                        loadFunc()
                    else
                        error("Failed to load script")
                    end
                end)
                
                if success then
                    btn.Text = " " .. text
                    btn.BackgroundColor3 = Color3.fromRGB(80, 255, 120)
                    statusLabel.Text = " Loaded: " .. text
                    
                    -- Close main GUI if specified (for Vertex)
                    if closesGUI then
                        task.wait(1)
                        unloadScript(player)
                    else
                        task.wait(2)
                        btn.Text = text
                        btn.BackgroundColor3 = Colors.Accent
                        btn.TextColor3 = Colors.Text
                    end
                else
                    btn.Text = " Failed"
                    btn.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
                    statusLabel.Text = " Failed to load: " .. tostring(err)
                    warn("Script load error: " .. tostring(err))
                    task.wait(2)
                    btn.Text = text
                    btn.BackgroundColor3 = Colors.Accent
                    btn.TextColor3 = Colors.Text
                end
            end)
        end)
        
        return btn
    end
    
    -- Script buttons with actual working URLs
    createScriptButton(
        scriptsSection,
        " Infinite Yield (Admin Commands)",
        40,
        "https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source",
        false
    )
    
    createScriptButton(
        scriptsSection,
        " Nameless Admin",
        100,
        "https://raw.githubusercontent.com/ltseverydayyou/Nameless-Admin/main/Source.lua",
        false
    )
    
    createScriptButton(
        scriptsSection,
        " Vertex Script Hub (Closes GUI)",
        160,
        "https://raw.smokingscripts.org/vertex.lua",
        true -- This one closes the GUI
    )
    
    -- Info label
    local infoLabel = Instance.new("TextLabel")
    infoLabel.Size = UDim2.new(1, -20, 0, 80)
    infoLabel.Position = UDim2.new(0, 10, 0, 230)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Text = " These are popular admin/hub scripts.\nClick a button to load the script.\n\n Vertex will close this GUI when loaded.\n   Use at your own risk - some games may detect scripts."
    infoLabel.TextColor3 = Colors.TextDim
    infoLabel.TextSize = 10
    infoLabel.Font = Enum.Font.Gotham
    infoLabel.TextWrapped = true
    infoLabel.TextXAlignment = Enum.TextXAlignment.Left
    infoLabel.TextYAlignment = Enum.TextYAlignment.Top
    infoLabel.Parent = scriptsSection

    
    -- ===== COMBAT TAB =====
    local combatPage = Instance.new("Frame")
    combatPage.Name = "CombatPage"
    combatPage.Size = UDim2.new(1, 0, 1, 0)
    combatPage.BackgroundTransparency = 1
    combatPage.Visible = false
    combatPage.Parent = contentArea
    tabPages["Combat"] = combatPage
    
    local chatSection = createSection(combatPage, "Chat Spammer", 0, 0, 230, 250)
    local chatSpamEnabled = false
    local chatSpamDelay = 1
    local chatSpamMessage = "Binxix's GUI is the best!"
    
    local msgLabel = Instance.new("TextLabel")
    msgLabel.Size = UDim2.new(1, -16, 0, 14)
    msgLabel.Position = UDim2.new(0, 8, 0, 18)
    msgLabel.BackgroundTransparency = 1
    msgLabel.Text = "Message:"
    msgLabel.TextColor3 = Colors.TextDim
    msgLabel.TextSize = 10
    msgLabel.Font = Enum.Font.Gotham
    msgLabel.TextXAlignment = Enum.TextXAlignment.Left
    msgLabel.Parent = chatSection
    
    local msgInputBox = Instance.new("TextBox")
    msgInputBox.Size = UDim2.new(1, -16, 0, 28)
    msgInputBox.Position = UDim2.new(0, 8, 0, 34)
    msgInputBox.BackgroundColor3 = Colors.BackgroundLight
    msgInputBox.BorderSizePixel = 0
    msgInputBox.Text = chatSpamMessage
    msgInputBox.PlaceholderText = "Enter message..."
    msgInputBox.TextColor3 = Colors.Text
    msgInputBox.PlaceholderColor3 = Colors.TextDim
    msgInputBox.TextSize = 10
    msgInputBox.Font = Enum.Font.Gotham
    msgInputBox.TextXAlignment = Enum.TextXAlignment.Left
    msgInputBox.ClearTextOnFocus = false
    msgInputBox.Parent = chatSection
    Instance.new("UICorner", msgInputBox).CornerRadius = UDim.new(0, 4)
    local mip = Instance.new("UIPadding"); mip.PaddingLeft = UDim.new(0, 8); mip.Parent = msgInputBox
    msgInputBox.FocusLost:Connect(function() chatSpamMessage = msgInputBox.Text end)
    
    createSlider(chatSection, "Delay (sec):", 8, 70, 0.5, 10, 1, function(v) chatSpamDelay = v end)
    createCheckbox(chatSection, "Enable Spam", 8, 108, false, function(e) chatSpamEnabled = e; statusLabel.Text = e and " Chat Spam ON" or " Chat Spam OFF" end)
    
    task.spawn(function()
        while true do
            task.wait(chatSpamDelay)
            if isUnloading then break end
            if chatSpamEnabled and chatSpamMessage ~= "" then
                pcall(function()
                    local ReplicatedStorage = game:GetService("ReplicatedStorage")
                    local chatEvents = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")
                    if chatEvents then
                        local sayEvent = chatEvents:FindFirstChild("SayMessageRequest")
                        if sayEvent then sayEvent:FireServer(chatSpamMessage, "All"); return end
                    end
                    local TextChatService = game:GetService("TextChatService")
                    local channels = TextChatService:FindFirstChild("TextChannels")
                    if channels then
                        local general = channels:FindFirstChild("RBXGeneral")
                        if general then general:SendAsync(chatSpamMessage) end
                    end
                end)
            end
        end
    end)
    
    local quickMsgLabel = Instance.new("TextLabel")
    quickMsgLabel.Size = UDim2.new(1, -16, 0, 14)
    quickMsgLabel.Position = UDim2.new(0, 8, 0, 140)
    quickMsgLabel.BackgroundTransparency = 1
    quickMsgLabel.Text = "Quick Messages:"
    quickMsgLabel.TextColor3 = Colors.TextDim
    quickMsgLabel.TextSize = 10
    quickMsgLabel.Font = Enum.Font.Gotham
    quickMsgLabel.TextXAlignment = Enum.TextXAlignment.Left
    quickMsgLabel.Parent = chatSection
    
    local quickMessages = {"GG", "EZ", "LOL", "Nice!", "Binxix on top"}
    for i, msg in ipairs(quickMessages) do
        local row = math.floor((i-1) / 3)
        local col = (i-1) % 3
        local quickBtn = Instance.new("TextButton")
        quickBtn.Size = UDim2.new(0, 65, 0, 22)
        quickBtn.Position = UDim2.new(0, 8 + col * 69, 0, 156 + row * 26)
        quickBtn.BackgroundColor3 = Colors.Accent
        quickBtn.BackgroundTransparency = 0.5
        quickBtn.Text = msg
        quickBtn.TextColor3 = Colors.Text
        quickBtn.TextSize = 9
        quickBtn.Font = Enum.Font.GothamMedium
        quickBtn.Parent = chatSection
        Instance.new("UICorner", quickBtn).CornerRadius = UDim.new(0, 4)
        quickBtn.MouseButton1Click:Connect(function()
            pcall(function()
                local ReplicatedStorage = game:GetService("ReplicatedStorage")
                local chatEvents = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")
                if chatEvents then local sayEvent = chatEvents:FindFirstChild("SayMessageRequest"); if sayEvent then sayEvent:FireServer(msg, "All"); statusLabel.Text = " Sent: " .. msg; return end end
                local TextChatService = game:GetService("TextChatService")
                local channels = TextChatService:FindFirstChild("TextChannels")
                if channels then local general = channels:FindFirstChild("RBXGeneral"); if general then general:SendAsync(msg); statusLabel.Text = " Sent: " .. msg end end
            end)
        end)
    end
    
    local otherSection = createSection(combatPage, "Other", 245, 0, 230, 120)
    local otherLabel = Instance.new("TextLabel")
    otherLabel.Size = UDim2.new(1, -16, 0, 80)
    otherLabel.Position = UDim2.new(0, 8, 0, 20)
    otherLabel.BackgroundTransparency = 1
    otherLabel.Text = "Combat features like No Recoil,\nRapid Fire, etc. have been removed\nas they are game-specific and often\nserver-sided."
    otherLabel.TextColor3 = Colors.TextDim
    otherLabel.TextSize = 10
    otherLabel.Font = Enum.Font.Gotham
    otherLabel.TextWrapped = true
    otherLabel.TextXAlignment = Enum.TextXAlignment.Left
    otherLabel.TextYAlignment = Enum.TextYAlignment.Top
    otherLabel.Parent = otherSection
    
    -- Tab switching
    for tabName, tabBtn in pairs(tabButtons) do
        tabBtn.MouseButton1Click:Connect(function()
            if isUnloading or _G.BinxixUnloaded then return end
            for name, btn in pairs(tabButtons) do
                btn.BackgroundColor3 = name == tabName and Colors.Accent or Colors.BackgroundLight
                btn.BackgroundTransparency = name == tabName and 0 or 0.3
                btn.TextColor3 = name == tabName and Colors.Text or Colors.TextDim
                btn.Font = name == tabName and Enum.Font.GothamBold or Enum.Font.Gotham
                local glow = btn:FindFirstChild("ActiveGlow")
                if glow then glow:Destroy() end
                if name == tabName then
                    local newGlow = Instance.new("UIStroke")
                    newGlow.Name = "ActiveGlow"
                    newGlow.Color = Color3.fromRGB(160, 100, 255)
                    newGlow.Thickness = 1
                    newGlow.Transparency = 0.5
                    newGlow.Parent = btn
                end
            end
            for name, page in pairs(tabPages) do page.Visible = name == tabName end
        end)
    end
    
    -- Input handlers
    local inputBeganConn = UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if isUnloading or _G.BinxixUnloaded then return end
        if gameProcessed then return end
        if input.KeyCode == Enum.KeyCode.RightControl then mainFrame.Visible = not mainFrame.Visible end
        if input.UserInputType == Enum.UserInputType.MouseButton2 then
            if trackingMode[player.UserId] == "hold" then 
                startRMBTracking()
            else
                if toggleTrackingActive[player.UserId] then 
                    toggleTrackingActive[player.UserId] = false
                    stopRMBTrackingUI()
                else 
                    toggleTrackingActive[player.UserId] = true
                    startRMBTracking() 
                end
            end
        end
    end)
    table.insert(allConnections, inputBeganConn)
    
    local inputEndedConn = UserInputService.InputEnded:Connect(function(input)
        if isUnloading or _G.BinxixUnloaded then return end
        if input.UserInputType == Enum.UserInputType.MouseButton2 then
            if trackingMode[player.UserId] == "hold" then stopRMBTrackingUI() end
        end
    end)
    table.insert(allConnections, inputEndedConn)
    
    -- Loaded Notification
    local loadedNotif = Instance.new("TextLabel")
    loadedNotif.Size = UDim2.new(0, 220, 0, 30)
    loadedNotif.Position = UDim2.new(0.5, -110, 1, -40)
    loadedNotif.BackgroundColor3 = Colors.Background
    loadedNotif.BackgroundTransparency = 0.3
    loadedNotif.BorderSizePixel = 0
    loadedNotif.Text = " Binxix's GUI V5 loaded"
    loadedNotif.TextColor3 = Colors.AccentBright
    loadedNotif.TextSize = 12
    loadedNotif.Font = Enum.Font.GothamBold
    loadedNotif.Parent = screenGui
    Instance.new("UICorner", loadedNotif).CornerRadius = UDim.new(0, 6)
    task.spawn(function()
        task.wait(3)
        for i = 0, 1, 0.05 do loadedNotif.BackgroundTransparency = 0.3 + (i * 0.7); loadedNotif.TextTransparency = i; task.wait(0.02) end
        loadedNotif:Destroy()
    end)
end

-- Initialize
createAdminGui(player)
